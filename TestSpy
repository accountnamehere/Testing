--!native

local CleanupModule = loadstring(game:HttpGet("https://raw.githubusercontent.com/altyaacct/Rspy/refs/heads/main/Cleanup"))()
local HookModule = loadstring(game:HttpGet("https://raw.githubusercontent.com/altyaacct/Rspy/refs/heads/main/Hook"))()
local UIGenModule = loadstring(game:HttpGet("https://raw.githubusercontent.com/altyaacct/Rspy/refs/heads/main/UiGen"))()
local CodeGenModule = loadstring(game:HttpGet("https://raw.githubusercontent.com/altyaacct/Rspy/refs/heads/main/CodeGen"))()

local bypassSuccess = false
local detectedFunc, killFunc
local hookedACFunctions = {}
local originalDebugInfo
local gcScanComplete = false

task.spawn(function()
    pcall(function()
        local getInfo = getinfo or debug.getinfo
        
        if setthreadidentity then
            setthreadidentity(2)
        elseif set_thread_identity then
            set_thread_identity(2)
        elseif syn and syn.set_thread_identity then
            syn.set_thread_identity(2)
        end
        
        local gcObjects = getgc(true)
        local totalObjects = #gcObjects
        local scannedCount = 0
        
        for _, value in ipairs(gcObjects) do
            scannedCount = scannedCount + 1
            
            if scannedCount % 500 == 0 then
                task.wait()
            end
            
            if typeof(value) == "table" then
                local detected = rawget(value, "Detected")
                local kill = rawget(value, "Kill")
                
                if typeof(detected) == "function" and not detectedFunc then
                    detectedFunc = detected
                    local originalHook = hookfunction(detectedFunc, newcclosure(function(method, info, ...)
                        if method ~= "_" then
                            task.spawn(function()
                                pcall(function()
                                    warn("[SimpleSpy V4] Adonis detection bypassed: " .. tostring(method))
                                end)
                            end)
                        end
                        return true
                    end))
                    table.insert(hookedACFunctions, {func = detectedFunc, original = originalHook})
                end
                
                if rawget(value, "Variables") and rawget(value, "Process") and typeof(kill) == "function" and not killFunc then
                    killFunc = kill
                    local originalHook = hookfunction(killFunc, newcclosure(function(info)
                        task.spawn(function()
                            pcall(function()
                                warn("[SimpleSpy V4] Adonis kill attempt blocked: " .. tostring(info))
                            end)
                        end)
                    end))
                    table.insert(hookedACFunctions, {func = killFunc, original = originalHook})
                end
            end
            
            if detectedFunc and killFunc then
                break
            end
        end
        
        gcScanComplete = true
        
        if getrenv and getrenv().debug and getrenv().debug.info then
            originalDebugInfo = hookfunction(getrenv().debug.info, newcclosure(function(...)
                local firstArg, _ = ...
                if detectedFunc and firstArg == detectedFunc then
                    return coroutine.yield(coroutine.running())
                end
                return originalDebugInfo(...)
            end))
        end
        
        if setthreadidentity then
            setthreadidentity(7)
        elseif set_thread_identity then
            set_thread_identity(7)
        elseif syn and syn.set_thread_identity then
            syn.set_thread_identity(7)
        end
        
        bypassSuccess = true
    end)
    
    if bypassSuccess then
        print("╔═══════════════════════════════════════╗")
        print("║   Anti-Cheat Bypass: ✓ SUCCESSFUL    ║")
        print("╚═══════════════════════════════════════╝")
    else
        warn("╔═══════════════════════════════════════╗")
        warn("║   Anti-Cheat Bypass: ⚠ PARTIAL        ║")
        warn("║   (Game may not have Adonis AC)       ║")
        warn("╚═══════════════════════════════════════╝")
    end
end)

if getgenv().SimpleSpyExecuted and type(getgenv().SimpleSpyShutdown) == "function" then
    pcall(getgenv().SimpleSpyShutdown)
end

local realconfigs = {
    logcheckcaller = false,
    autoblock = false,
    funcEnabled = true,
    advancedinfo = false,
    supersecretdevtoggle = false,
    tabsOpen = true
}

local configs = newproxy(true)
local configsmetatable = getmetatable(configs)

configsmetatable.__index = function(self,index)
    return realconfigs[index]
end

local oth = syn and syn.oth
local unhook = oth and oth.unhook
local hook = oth and oth.hook

local lower = string.lower
local byte = string.byte
local round = math.round
local running = coroutine.running
local resume = coroutine.resume
local status = coroutine.status
local yield = coroutine.yield
local create = coroutine.create
local close = coroutine.close
local OldDebugId = game.GetDebugId
local info = debug.info

local IsA = game.IsA
local tostring = tostring
local tonumber = tonumber
local delay = task.delay
local spawn = task.spawn
local clear = table.clear
local clone = table.clone

local function blankfunction(...)
    return ...
end

local get_thread_identity = (syn and syn.get_thread_identity) or getidentity or getthreadidentity
local set_thread_identity = (syn and syn.set_thread_identity) or setidentity
local islclosure = islclosure or is_l_closure
local threadfuncs = (get_thread_identity and set_thread_identity and true) or false

local getinfo = getinfo or blankfunction
local getupvalues = getupvalues or debug.getupvalues or blankfunction
local getconstants = getconstants or debug.getconstants or blankfunction

local getcustomasset = getsynasset or getcustomasset
local getcallingscript = getcallingscript or blankfunction
local newcclosure = newcclosure or blankfunction
local clonefunction = clonefunction or blankfunction
local cloneref = cloneref or blankfunction
local request = request or syn and syn.request
local makewritable = makewriteable or function(tbl)
    setreadonly(tbl,false)
end
local makereadonly = makereadonly or function(tbl)
    setreadonly(tbl,true)
end
local isreadonly = isreadonly or table.isfrozen

local setclipboard = setclipboard or toclipboard or set_clipboard or (Clipboard and Clipboard.set) or function(...)
    return ErrorPrompt("Attempted to set clipboard: "..(...),true)
end

local hookmetamethod = hookmetamethod or (makewriteable and makereadonly and getrawmetatable) and function(obj: object, metamethod: string, func: Function)
    local old = getrawmetatable(obj)

    if hookfunction then
        return hookfunction(old[metamethod],func)
    else
        local oldmetamethod = old[metamethod]
        makewriteable(old)
        old[metamethod] = func
        makereadonly(old)
        return oldmetamethod
    end
end

local function Create(instance, properties, children)
    local obj = Instance.new(instance)

    for i, v in next, properties or {} do
        obj[i] = v
        for _, child in next, children or {} do
            child.Parent = obj;
        end
    end
    return obj;
end

local function SafeGetService(service)
    return cloneref(game:GetService(service))
end

local function Search(logtable,tbl)
    table.insert(logtable,tbl)
    
    for i,v in tbl do
        if type(v) == "table" then
            return table.find(logtable,v) ~= nil or Search(v)
        end
    end
end

local function IsCyclicTable(tbl)
    local checkedtables = {}

    local function SearchTable(tbl)
        table.insert(checkedtables,tbl)
        
        for i,v in next, tbl do
            if type(v) == "table" then
                return table.find(checkedtables,v) and true or SearchTable(v)
            end
        end
    end

    return SearchTable(tbl)
end

local function deepclone(args: table, copies: table): table
    local copy = nil
    copies = copies or {}

    if type(args) == 'table' then
        if copies[args] then
            copy = copies[args]
        else
            copy = {}
            copies[args] = copy
            for i, v in next, args do
                copy[deepclone(i, copies)] = deepclone(v, copies)
            end
        end
    elseif typeof(args) == "Instance" then
        copy = cloneref(args)
    else
        copy = args
    end
    return copy
end

local function rawtostring(userdata)
    if type(userdata) == "table" or typeof(userdata) == "userdata" then
        local rawmetatable = getrawmetatable(userdata)
        local cachedstring = rawmetatable and rawget(rawmetatable, "__tostring")

        if cachedstring then
            local wasreadonly = isreadonly(rawmetatable)
            if wasreadonly then
                makewritable(rawmetatable)
            end
            rawset(rawmetatable, "__tostring", nil)
            local safestring = tostring(userdata)
            rawset(rawmetatable, "__tostring", cachedstring)
            if wasreadonly then
                makereadonly(rawmetatable)
            end
            return safestring
        end
    end
    return tostring(userdata)
end

local CoreGui = SafeGetService("CoreGui")
local Players = SafeGetService("Players")
local RunService = SafeGetService("RunService")
local UserInputService = SafeGetService("UserInputService")
local TweenService = SafeGetService("TweenService")
local ContentProvider = SafeGetService("ContentProvider")
local TextService = SafeGetService("TextService")
local http = SafeGetService("HttpService")
local MarketplaceService = SafeGetService("MarketplaceService")
local GuiInset = game:GetService("GuiService"):GetGuiInset() :: Vector2

local function jsone(str) return http:JSONEncode(str) end
local function jsond(str)
    local suc,err = pcall(http.JSONDecode,http,str)
    return suc and err or suc
end

function ErrorPrompt(Message,state)
    if getrenv then
        local ErrorPrompt = getrenv().require(CoreGui:WaitForChild("RobloxGui"):WaitForChild("Modules"):WaitForChild("ErrorPrompt"))
        local prompt = ErrorPrompt.new("Default",{HideErrorCode = true})
        local ErrorStoarge = Create("ScreenGui",{Parent = CoreGui,ResetOnSpawn = false})
        local thread = state and running()
        prompt:setParent(ErrorStoarge)
        prompt:setErrorTitle("Simple Spy V4 Error")
        prompt:updateButtons({{
            Text = "Proceed",
            Callback = function()
                prompt:_close()
                ErrorStoarge:Destroy()
                if thread then
                    resume(thread)
                end
            end,
            Primary = true
        }}, 'Default')
        prompt:_open(Message)
        if thread then
            yield(thread)
        end
    else
        warn(Message)
    end
end

local Highlight = (isfile and loadfile and isfile("Highlight.lua") and loadfile("Highlight.lua")()) or loadstring(game:HttpGet("https://raw.githubusercontent.com/infyiff/backup/refs/heads/main/SimpleSpyV3/highlight.lua"))()
local LazyFix = loadstring(game:HttpGet("https://raw.githubusercontent.com/infyiff/backup/refs/heads/main/SimpleSpyV3/DataToCode.lua"))()

local SimpleSpy3 = Create("ScreenGui",{ResetOnSpawn = false})
local Storage = Create("Folder",{})
local Background = Create("Frame",{Parent = SimpleSpy3,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 500, 0, 200),Size = UDim2.new(0, 500, 0, 268)})

local TabSidebar = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(30, 30, 32),BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 19),Size = UDim2.new(0, 50, 0, 249)})
local TabList = Create("Frame",{Parent = TabSidebar,BackgroundTransparency = 1,Size = UDim2.new(1, 0, 1, 0)})

local RSpyTab = Create("TextButton",{Parent = TabList,BackgroundColor3 = Color3.fromRGB(92, 126, 229),BorderSizePixel = 0,Size = UDim2.new(1, 0, 0, 50),Font = Enum.Font.SourceSansBold,Text = "RSpy",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local EditorTab = Create("TextButton",{Parent = TabList,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 50),Size = UDim2.new(1, 0, 0, 50),Font = Enum.Font.SourceSansBold,Text = "Editor",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local NotesTab = Create("TextButton",{Parent = TabList,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 100),Size = UDim2.new(1, 0, 0, 50),Font = Enum.Font.SourceSansBold,Text = "Notes",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})

local LeftPanel = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(53, 52, 55),BorderSizePixel = 0,Position = UDim2.new(0, 50, 0, 19),Size = UDim2.new(0, 131, 0, 249),Visible = true})
local LogList = Create("ScrollingFrame",{Parent = LeftPanel,Active = true,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 9),Size = UDim2.new(0, 131, 0, 232),CanvasSize = UDim2.new(0, 0, 0, 0),ScrollBarThickness = 4})
local UIListLayout = Create("UIListLayout",{Parent = LogList,HorizontalAlignment = Enum.HorizontalAlignment.Center,SortOrder = Enum.SortOrder.LayoutOrder})

local EditorLeftPanel = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(53, 52, 55),BorderSizePixel = 0,Position = UDim2.new(0, 50, 0, 19),Size = UDim2.new(0, 131, 0, 249),Visible = false})
local EditorList = Create("ScrollingFrame",{Parent = EditorLeftPanel,Active = true,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 9),Size = UDim2.new(0, 131, 0, 232),CanvasSize = UDim2.new(0, 0, 0, 0),ScrollBarThickness = 4})
local EditorUIListLayout = Create("UIListLayout",{Parent = EditorList,HorizontalAlignment = Enum.HorizontalAlignment.Center,SortOrder = Enum.SortOrder.LayoutOrder})

local NotesLeftPanel = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(53, 52, 55),BorderSizePixel = 0,Position = UDim2.new(0, 50, 0, 19),Size = UDim2.new(0, 131, 0, 249),Visible = false})
local NotesList = Create("ScrollingFrame",{Parent = NotesLeftPanel,Active = true,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 9),Size = UDim2.new(0, 131, 0, 202),CanvasSize = UDim2.new(0, 0, 0, 0),ScrollBarThickness = 4})
local NotesUIListLayout = Create("UIListLayout",{Parent = NotesList,HorizontalAlignment = Enum.HorizontalAlignment.Center,SortOrder = Enum.SortOrder.LayoutOrder})
local NewNoteBtn = Create("TextButton",{Parent = NotesLeftPanel,BackgroundColor3 = Color3.fromRGB(68, 206, 91),BorderSizePixel = 0,Position = UDim2.new(0, 5, 1, -25),Size = UDim2.new(0, 60, 0, 20),Font = Enum.Font.SourceSansBold,Text = "New",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local LoadNoteBtn = Create("TextButton",{Parent = NotesLeftPanel,BackgroundColor3 = Color3.fromRGB(92, 126, 229),BorderSizePixel = 0,Position = UDim2.new(0, 66, 1, -25),Size = UDim2.new(0, 60, 0, 20),Font = Enum.Font.SourceSansBold,Text = "Load",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})

local RightPanel = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(37, 36, 38),BorderSizePixel = 0,Position = UDim2.new(0, 181, 0, 19),Size = UDim2.new(0, 319, 0, 249),Visible = true})
local CodeBox = Create("Frame",{Parent = RightPanel,BackgroundColor3 = Color3.new(0.0823529, 0.0745098, 0.0784314),BorderSizePixel = 0,Size = UDim2.new(0, 319, 0, 119)})
local ScrollingFrame = Create("ScrollingFrame",{Parent = RightPanel,Active = true,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 0, 0.5, 0),Size = UDim2.new(1, 0, 0.5, -9),CanvasSize = UDim2.new(0, 0, 0, 0),ScrollBarThickness = 4})
local UIGridLayout = Create("UIGridLayout",{Parent = ScrollingFrame,HorizontalAlignment = Enum.HorizontalAlignment.Center,SortOrder = Enum.SortOrder.LayoutOrder,CellPadding = UDim2.new(0, 0, 0, 0),CellSize = UDim2.new(0, 94, 0, 27)})

local EditorRightPanel = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(37, 36, 38),BorderSizePixel = 0,Position = UDim2.new(0, 181, 0, 19),Size = UDim2.new(0, 319, 0, 249),Visible = false})
local EditorCodeBox = Create("Frame",{Parent = EditorRightPanel,BackgroundColor3 = Color3.new(0.0823529, 0.0745098, 0.0784314),BorderSizePixel = 0,Size = UDim2.new(1, 0, 1, -30)})
local EditorScrollFrame = Create("ScrollingFrame",{Parent = EditorCodeBox,BackgroundTransparency = 1,Size = UDim2.new(1, 0, 1, 0),CanvasSize = UDim2.new(0, 0, 2, 0),ScrollBarThickness = 6})
local EditorTextBox = Create("TextBox",{Parent = EditorScrollFrame,BackgroundTransparency = 1,Size = UDim2.new(1, -10, 1, 0),Position = UDim2.new(0, 5, 0, 0),Font = Enum.Font.Code,Text = "",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,TextXAlignment = Enum.TextXAlignment.Left,TextYAlignment = Enum.TextYAlignment.Top,ClearTextOnFocus = false,MultiLine = true,TextEditable = true})

local EditorButtonsFrame = Create("Frame",{Parent = EditorRightPanel,BackgroundColor3 = Color3.fromRGB(30, 30, 32),BorderSizePixel = 0,Position = UDim2.new(0, 0, 1, -30),Size = UDim2.new(1, 0, 0, 30)})
local EditorUndoBtn = Create("TextButton",{Parent = EditorButtonsFrame,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Position = UDim2.new(0, 5, 0, 5),Size = UDim2.new(0, 50, 0, 20),Font = Enum.Font.SourceSans,Text = "Undo",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local EditorRedoBtn = Create("TextButton",{Parent = EditorButtonsFrame,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Position = UDim2.new(0, 60, 0, 5),Size = UDim2.new(0, 50, 0, 20),Font = Enum.Font.SourceSans,Text = "Redo",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local EditorClearBtn = Create("TextButton",{Parent = EditorButtonsFrame,BackgroundColor3 = Color3.fromRGB(252, 51, 51),BorderSizePixel = 0,Position = UDim2.new(0, 115, 0, 5),Size = UDim2.new(0, 50, 0, 20),Font = Enum.Font.SourceSans,Text = "Clear",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local EditorRunBtn = Create("TextButton",{Parent = EditorButtonsFrame,BackgroundColor3 = Color3.fromRGB(68, 206, 91),BorderSizePixel = 0,Position = UDim2.new(0, 170, 0, 5),Size = UDim2.new(0, 50, 0, 20),Font = Enum.Font.SourceSans,Text = "Run",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local EditorRenameBtn = Create("TextButton",{Parent = EditorButtonsFrame,BackgroundColor3 = Color3.fromRGB(255, 165, 0),BorderSizePixel = 0,Position = UDim2.new(0, 225, 0, 5),Size = UDim2.new(0, 50, 0, 20),Font = Enum.Font.SourceSans,Text = "Rename",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})

local NotesRightPanel = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(37, 36, 38),BorderSizePixel = 0,Position = UDim2.new(0, 181, 0, 19),Size = UDim2.new(0, 319, 0, 249),Visible = false})
local NotesCodeBox = Create("Frame",{Parent = NotesRightPanel,BackgroundColor3 = Color3.new(0.0823529, 0.0745098, 0.0784314),BorderSizePixel = 0,Size = UDim2.new(1, 0, 1, -30)})
local NotesScrollFrame = Create("ScrollingFrame",{Parent = NotesCodeBox,BackgroundTransparency = 1,Size = UDim2.new(1, 0, 1, 0),CanvasSize = UDim2.new(0, 0, 2, 0),ScrollBarThickness = 6})
local NotesTextBox = Create("TextBox",{Parent = NotesScrollFrame,BackgroundTransparency = 1,Size = UDim2.new(1, -10, 1, 0),Position = UDim2.new(0, 5, 0, 0),Font = Enum.Font.Code,Text = "",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,TextXAlignment = Enum.TextXAlignment.Left,TextYAlignment = Enum.TextYAlignment.Top,ClearTextOnFocus = false,MultiLine = true,TextEditable = true})

local NotesButtonsFrame = Create("Frame",{Parent = NotesRightPanel,BackgroundColor3 = Color3.fromRGB(30, 30, 32),BorderSizePixel = 0,Position = UDim2.new(0, 0, 1, -30),Size = UDim2.new(1, 0, 0, 30)})
local NotesSaveBtn = Create("TextButton",{Parent = NotesButtonsFrame,BackgroundColor3 = Color3.fromRGB(68, 206, 91),BorderSizePixel = 0,Position = UDim2.new(0, 5, 0, 5),Size = UDim2.new(0, 60, 0, 20),Font = Enum.Font.SourceSans,Text = "Save",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local NotesDeleteBtn = Create("TextButton",{Parent = NotesButtonsFrame,BackgroundColor3 = Color3.fromRGB(252, 51, 51),BorderSizePixel = 0,Position = UDim2.new(0, 70, 0, 5),Size = UDim2.new(0, 60, 0, 20),Font = Enum.Font.SourceSans,Text = "Delete",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
local NotesRenameBtn = Create("TextButton",{Parent = NotesButtonsFrame,BackgroundColor3 = Color3.fromRGB(255, 165, 0),BorderSizePixel = 0,Position = UDim2.new(0, 135, 0, 5),Size = UDim2.new(0, 60, 0, 20),Font = Enum.Font.SourceSans,Text = "Rename",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})

local FileBrowser = Create("Frame",{Parent = SimpleSpy3,BackgroundColor3 = Color3.fromRGB(30, 30, 32),BorderSizePixel = 1,BorderColor3 = Color3.new(1, 1, 1),Position = UDim2.new(0.5, -150, 0.5, -100),Size = UDim2.new(0, 300, 0, 200),Visible = false,ZIndex = 10})
local BrowserTitle = Create("TextLabel",{Parent = FileBrowser,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Size = UDim2.new(1, 0, 0, 25),Font = Enum.Font.SourceSansBold,Text = "Load Note",TextColor3 = Color3.new(1, 1, 1),TextSize = 16,ZIndex = 10})
local BrowserClose = Create("TextButton",{Parent = FileBrowser,BackgroundColor3 = Color3.fromRGB(252, 51, 51),BorderSizePixel = 0,Position = UDim2.new(1, -25, 0, 0),Size = UDim2.new(0, 25, 0, 25),Font = Enum.Font.SourceSansBold,Text = "X",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ZIndex = 10})
local FileList = Create("ScrollingFrame",{Parent = FileBrowser,BackgroundColor3 = Color3.fromRGB(37, 36, 38),BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 25),Size = UDim2.new(1, 0, 1, -25),CanvasSize = UDim2.new(0, 0, 0, 0),ScrollBarThickness = 6,ZIndex = 10})
local FileListLayout = Create("UIListLayout",{Parent = FileList,HorizontalAlignment = Enum.HorizontalAlignment.Center,SortOrder = Enum.SortOrder.LayoutOrder,Padding = UDim.new(0, 2)})

local TopBar = Create("Frame",{Parent = Background,BackgroundColor3 = Color3.fromRGB(37, 35, 38),BorderSizePixel = 0,Size = UDim2.new(0, 500, 0, 19)})
local Simple = Create("TextButton",{Parent = TopBar,BackgroundColor3 = Color3.new(1, 1, 1),AutoButtonColor = false,BackgroundTransparency = 1,Position = UDim2.new(0, 5, 0, 0),Size = UDim2.new(0, 57, 0, 18),Font = Enum.Font.SourceSansBold,Text =  "SimpleSpy",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,TextXAlignment = Enum.TextXAlignment.Left})
local CloseButton = Create("TextButton",{Parent = TopBar,BackgroundColor3 = Color3.new(0.145098, 0.141176, 0.14902),BorderSizePixel = 0,Position = UDim2.new(1, -19, 0, 0),Size = UDim2.new(0, 19, 0, 19),Font = Enum.Font.SourceSans,Text = "",TextColor3 = Color3.new(0, 0, 0),TextSize = 14})
local ImageLabel = Create("ImageLabel",{Parent = CloseButton,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 5, 0, 5),Size = UDim2.new(0, 9, 0, 9),Image = "http://www.roblox.com/asset/?id=5597086202"})
local MaximizeButton = Create("TextButton",{Parent = TopBar,BackgroundColor3 = Color3.new(0.145098, 0.141176, 0.14902),BorderSizePixel = 0,Position = UDim2.new(1, -38, 0, 0),Size = UDim2.new(0, 19, 0, 19),Font = Enum.Font.SourceSans,Text = "",TextColor3 = Color3.new(0, 0, 0),TextSize = 14})
local ImageLabel_2 = Create("ImageLabel",{Parent = MaximizeButton,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 5, 0, 5),Size = UDim2.new(0, 9, 0, 9),Image = "http://www.roblox.com/asset/?id=5597108117"})
local MinimizeButton = Create("TextButton",{Parent = TopBar,BackgroundColor3 = Color3.new(0.145098, 0.141176, 0.14902),BorderSizePixel = 0,Position = UDim2.new(1, -57, 0, 0),Size = UDim2.new(0, 19, 0, 19),Font = Enum.Font.SourceSans,Text = "",TextColor3 = Color3.new(0, 0, 0),TextSize = 14})
local ImageLabel_3 = Create("ImageLabel",{Parent = MinimizeButton,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 5, 0, 5),Size = UDim2.new(0, 9, 0, 9),Image = "http://www.roblox.com/asset/?id=5597105827"})
local TabToggleButton = Create("TextButton",{Parent = TopBar,BackgroundColor3 = Color3.new(0.145098, 0.141176, 0.14902),BorderSizePixel = 0,Position = UDim2.new(1, -76, 0, 0),Size = UDim2.new(0, 19, 0, 19),Font = Enum.Font.SourceSans,Text = "",TextColor3 = Color3.new(0, 0, 0),TextSize = 14})
local TabToggleImage = Create("ImageLabel",{Parent = TabToggleButton,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 5, 0, 5),Size = UDim2.new(0, 9, 0, 9),Image = "http://www.roblox.com/asset/?id=5597105827"})

local ToolTip = Create("Frame",{Parent = SimpleSpy3,BackgroundColor3 = Color3.fromRGB(26, 26, 26),BackgroundTransparency = 0.1,BorderColor3 = Color3.new(1, 1, 1),Size = UDim2.new(0, 200, 0, 50),ZIndex = 3,Visible = false})
local TextLabel = Create("TextLabel",{Parent = ToolTip,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 2, 0, 2),Size = UDim2.new(0, 196, 0, 46),ZIndex = 3,Font = Enum.Font.SourceSans,Text = "This is some slightly longer text.",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,TextWrapped = true,TextXAlignment = Enum.TextXAlignment.Left,TextYAlignment = Enum.TextYAlignment.Top})

local selectedColor = Color3.new(0.321569, 0.333333, 1)
local deselectedColor = Color3.new(0.8, 0.8, 0.8)
local layoutOrderNum = 999999999
local mainClosing = false
local closed = false
local sideClosing = false
local sideClosed = false
local maximized = false
local logs = {}
local selected = nil
local blacklist = {}
local blocklist = {}
local getNil = false
local connectedRemotes = {}
local toggle = false
local prevTables = {}
local remoteLogs = {}
getgenv().SIMPLESPYCONFIG_MaxRemotes = 300
local indent = 4
local scheduled = {}
local schedulerconnect
local SimpleSpy = {}
local topstr = ""
local bottomstr = ""
local remotesFadeIn
local rightFadeIn
local codebox
local p
local getnilrequired = false
local history = {}
local excluding = {}
local mouseInGui = false
local connections = {}
local DecompiledScripts = {}
local generation = {}
local running_threads = {}
local originalnamecall
local currentTab = "rspy"
local editorTabs = {}
local selectedEditorTab = nil
local notesTabs = {}
local selectedNotesTab = nil
local tabsOpen = true
local editorUndoHistory = {}
local editorRedoHistory = {}
local editorCurrentIndex = 0
local notesUndoHistory = {}
local notesRedoHistory = {}

local remoteEvent = Instance.new("RemoteEvent",Storage)
local unreliableRemoteEvent = Instance.new("UnreliableRemoteEvent")
local remoteFunction = Instance.new("RemoteFunction",Storage)
local NamecallHandler = Instance.new("BindableEvent",Storage)
local IndexHandler = Instance.new("BindableEvent",Storage)
local GetDebugIdHandler = Instance.new("BindableFunction",Storage)

local originalEvent = remoteEvent.FireServer
local originalUnreliableEvent = unreliableRemoteEvent.FireServer
local originalFunction = remoteFunction.InvokeServer
local GetDebugIDInvoke = GetDebugIdHandler.Invoke

function GetDebugIdHandler.OnInvoke(obj: Instance)
    return OldDebugId(obj)
end

local function ThreadGetDebugId(obj: Instance): string 
    return GetDebugIDInvoke(GetDebugIdHandler,obj)
end

local synv3 = false

if syn and identifyexecutor then
    local _, version = identifyexecutor()
    if (version and version:sub(1, 2) == 'v3') then
        synv3 = true
    end
end

xpcall(function()
    if isfile and readfile and isfolder and makefolder then
        local cachedconfigs = isfile("SimpleSpy//Settings.json") and jsond(readfile("SimpleSpy//Settings.json"))

        if cachedconfigs then
            for i,v in next, realconfigs do
                if cachedconfigs[i] == nil then
                    cachedconfigs[i] = v
                end
            end
            realconfigs = cachedconfigs
        end

        if not isfolder("SimpleSpy") then
            makefolder("SimpleSpy")
        end
        if not isfolder("SimpleSpy//Assets") then
            makefolder("SimpleSpy//Assets")
        end
        if not isfile("SimpleSpy//Settings.json") then
            writefile("SimpleSpy//Settings.json",jsone(realconfigs))
        end

        configsmetatable.__newindex = function(self,index,newindex)
            realconfigs[index] = newindex
            writefile("SimpleSpy//Settings.json",jsone(realconfigs))
        end
    else
        configsmetatable.__newindex = function(self,index,newindex)
            realconfigs[index] = newindex
        end
    end
end,function(err)
    ErrorPrompt(("An error has occured: (%s)"):format(err))
end)

local function logthread(thread: thread)
    table.insert(running_threads,thread)
end

function clean()
    local max = getgenv().SIMPLESPYCONFIG_MaxRemotes
    if not typeof(max) == "number" and math.floor(max) ~= max then
        max = 500
    end
    if #remoteLogs > max then
        for i = 100, #remoteLogs do
            local v = remoteLogs[i]
            if typeof(v[1]) == "RBXScriptConnection" then
                v[1]:Disconnect()
            end
            if typeof(v[2]) == "Instance" then
                v[2]:Destroy()
            end
        end
        local newLogs = {}
        for i = 1, 100 do
            table.insert(newLogs, remoteLogs[i])
        end
        remoteLogs = newLogs
    end
end

local function ThreadIsNotDead(thread: thread): boolean
    return not status(thread) == "dead"
end

function scaleToolTip()
    local size = TextService:GetTextSize(TextLabel.Text, TextLabel.TextSize, TextLabel.Font, Vector2.new(196, math.huge))
    TextLabel.Size = UDim2.new(0, size.X, 0, size.Y)
    ToolTip.Size = UDim2.new(0, size.X + 4, 0, size.Y + 4)
end

function onToggleButtonHover()
    if not toggle then
        TweenService:Create(Simple, TweenInfo.new(0.5), {TextColor3 = Color3.fromRGB(252, 51, 51)}):Play()
    else
        TweenService:Create(Simple, TweenInfo.new(0.5), {TextColor3 = Color3.fromRGB(68, 206, 91)}):Play()
    end
end

function onToggleButtonUnhover()
    TweenService:Create(Simple, TweenInfo.new(0.5), {TextColor3 = Color3.fromRGB(255, 255, 255)}):Play()
end

function onXButtonHover()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 60, 60)}):Play()
end

function onXButtonUnhover()
    TweenService:Create(CloseButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(37, 36, 38)}):Play()
end

function onToggleButtonClick()
    if toggle then
        TweenService:Create(Simple, TweenInfo.new(0.5), {TextColor3 = Color3.fromRGB(252, 51, 51)}):Play()
    else
        TweenService:Create(Simple, TweenInfo.new(0.5), {TextColor3 = Color3.fromRGB(68, 206, 91)}):Play()
    end
    toggleSpyMethod()
end

function connectResize()
    if not workspace.CurrentCamera then
        workspace:GetPropertyChangedSignal("CurrentCamera"):Wait()
    end
    local lastCam = workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(bringBackOnResize)
    workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(function()
        lastCam:Disconnect()
        if typeof(lastCam) == 'Connection' then
            lastCam:Disconnect()
        end
        lastCam = workspace.CurrentCamera:GetPropertyChangedSignal("ViewportSize"):Connect(bringBackOnResize)
    end)
end

function bringBackOnResize()
    validateSize()
    if sideClosed then
        minimizeSize()
    else
        maximizeSize()
    end
    local currentX = Background.AbsolutePosition.X
    local currentY = Background.AbsolutePosition.Y
    local viewportSize = workspace.CurrentCamera.ViewportSize
    if (currentX < 0) or (currentX > (viewportSize.X - (sideClosed and 181 or Background.AbsoluteSize.X))) then
        if currentX < 0 then
            currentX = 0
        else
            currentX = viewportSize.X - (sideClosed and 181 or Background.AbsoluteSize.X)
        end
    end
    if (currentY < 0) or (currentY > (viewportSize.Y - (closed and 19 or Background.AbsoluteSize.Y) - GuiInset.Y)) then
        if currentY < 0 then
            currentY = 0
        else
            currentY = viewportSize.Y - (closed and 19 or Background.AbsoluteSize.Y) - GuiInset.Y
        end
    end
    TweenService.Create(TweenService, Background, TweenInfo.new(0.1), {Position = UDim2.new(0, currentX, 0, currentY)}):Play()
end

function onBarInput(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        local lastPos = UserInputService:GetMouseLocation()
        local mainPos = Background.AbsolutePosition
        local offset = mainPos - lastPos
        local currentPos = offset + lastPos
        if not connections["drag"] then
            connections["drag"] = RunService.RenderStepped:Connect(function()
                local newPos = UserInputService:GetMouseLocation()
                if newPos ~= lastPos then
                    local currentX = (offset + newPos).X
                    local currentY = (offset + newPos).Y
                    local viewportSize = workspace.CurrentCamera.ViewportSize
                    if (currentX < 0 and currentX < currentPos.X) or (currentX > (viewportSize.X - (sideClosed and 181 or TopBar.AbsoluteSize.X)) and currentX > currentPos.X) then
                        if currentX < 0 then
                            currentX = 0
                        else
                            currentX = viewportSize.X - (sideClosed and 181 or TopBar.AbsoluteSize.X)
                        end
                    end
                    if (currentY < 0 and currentY < currentPos.Y) or (currentY > (viewportSize.Y - (closed and 19 or Background.AbsoluteSize.Y) - GuiInset.Y) and currentY > currentPos.Y) then
                        if currentY < 0 then
                            currentY = 0
                        else
                            currentY = viewportSize.Y - (closed and 19 or Background.AbsoluteSize.Y) - GuiInset.Y
                        end
                    end
                    currentPos = Vector2.new(currentX, currentY)
                    lastPos = newPos
                    TweenService.Create(TweenService, Background, TweenInfo.new(0.1), {Position = UDim2.new(0, currentPos.X, 0, currentPos.Y)}):Play()
                end
            end)
        end
        table.insert(connections, UserInputService.InputEnded:Connect(function(inputE)
            if input == inputE then
                if connections["drag"] then
                    connections["drag"]:Disconnect()
                    connections["drag"] = nil
                end
            end
        end))
    end
end

local function fadeOut(elements)
    local data = {}
    for _, v in next, elements do
        if typeof(v) == "Instance" and v:IsA("GuiObject") and v.Visible then
            spawn(function()
                data[v] = {
                    BackgroundTransparency = v.BackgroundTransparency
                }
                TweenService:Create(v, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
                if v:IsA("TextBox") or v:IsA("TextButton") or v:IsA("TextLabel") then
                    data[v].TextTransparency = v.TextTransparency
                    TweenService:Create(v, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
                elseif v:IsA("ImageButton") or v:IsA("ImageLabel") then
                    data[v].ImageTransparency = v.ImageTransparency
                    TweenService:Create(v, TweenInfo.new(0.5), {ImageTransparency = 1}):Play()
                end
                delay(0.5,function()
                    v.Visible = false
                    for i, x in next, data[v] do
                        v[i] = x
                    end
                    data[v] = true
                end)
            end)
        end
    end
    return function()
        for i, _ in next, data do
            spawn(function()
                local properties = {
                    BackgroundTransparency = i.BackgroundTransparency
                }
                i.BackgroundTransparency = 1
                TweenService:Create(i, TweenInfo.new(0.5), {BackgroundTransparency = properties.BackgroundTransparency}):Play()
                if i:IsA("TextBox") or i:IsA("TextButton") or i:IsA("TextLabel") then
                    properties.TextTransparency = i.TextTransparency
                    i.TextTransparency = 1
                    TweenService:Create(i, TweenInfo.new(0.5), {TextTransparency = properties.TextTransparency}):Play()
                elseif i:IsA("ImageButton") or i:IsA("ImageLabel") then
                    properties.ImageTransparency = i.ImageTransparency
                    i.ImageTransparency = 1
                    TweenService:Create(i, TweenInfo.new(0.5), {ImageTransparency = properties.ImageTransparency}):Play()
                end
                i.Visible = true
            end)
        end
    end
end

function toggleMinimize(override)
    if mainClosing and not override or maximized then
        return
    end
    mainClosing = true
    closed = not closed
    if closed then
        if not sideClosed then
            toggleSideTray(true)
        end
        local currentPanel = currentTab == "rspy" and LeftPanel or currentTab == "editor" and EditorLeftPanel or NotesLeftPanel
        currentPanel.Visible = true
        remotesFadeIn = fadeOut(currentPanel:GetDescendants())
        TweenService:Create(currentPanel, TweenInfo.new(0.5), {Size = UDim2.new(0, 131, 0, 0)}):Play()
        wait(0.5)
    else
        local currentPanel = currentTab == "rspy" and LeftPanel or currentTab == "editor" and EditorLeftPanel or NotesLeftPanel
        TweenService:Create(currentPanel, TweenInfo.new(0.5), {Size = UDim2.new(0, 131, 0, 249)}):Play()
        wait(0.5)
        if remotesFadeIn then
            remotesFadeIn()
            remotesFadeIn = nil
        end
        bringBackOnResize()
    end
    mainClosing = false
end

function toggleSideTray(override)
    if sideClosing and not override or maximized then
        return
    end
    sideClosing = true
    sideClosed = not sideClosed
    if sideClosed then
        local currentPanel = currentTab == "rspy" and RightPanel or currentTab == "editor" and EditorRightPanel or NotesRightPanel
        rightFadeIn = fadeOut(currentPanel:GetDescendants())
        wait(0.5)
        minimizeSize(0.5)
        wait(0.5)
        currentPanel.Visible = false
    else
        if closed then
            toggleMinimize(true)
        end
        local currentPanel = currentTab == "rspy" and RightPanel or currentTab == "editor" and EditorRightPanel or NotesRightPanel
        currentPanel.Visible = true
        maximizeSize(0.5)
        wait(0.5)
        if rightFadeIn then
            rightFadeIn()
        end
        bringBackOnResize()
    end
    sideClosing = false
end

function toggleMaximize()
    if not sideClosed and not maximized then
        maximized = true
        local disable = Instance.new("TextButton")
        local currentCodeBox = currentTab == "rspy" and CodeBox or currentTab == "editor" and EditorCodeBox or NotesCodeBox
        local prevSize = UDim2.new(0, currentCodeBox.AbsoluteSize.X, 0, currentCodeBox.AbsoluteSize.Y)
        local prevPos = UDim2.new(0,currentCodeBox.AbsolutePosition.X, 0, currentCodeBox.AbsolutePosition.Y)
        disable.Size = UDim2.new(1, 0, 1, 0)
        disable.BackgroundColor3 = Color3.new()
        disable.BorderSizePixel = 0
        disable.Text = 0
        disable.ZIndex = 3
        disable.BackgroundTransparency = 1
        disable.AutoButtonColor = false
        currentCodeBox.ZIndex = 4
        currentCodeBox.Position = prevPos
        currentCodeBox.Size = prevSize
        TweenService:Create(currentCodeBox, TweenInfo.new(0.5), {Size = UDim2.new(0.5, 0, 0.5, 0), Position = UDim2.new(0.25, 0, 0.25, 0)}):Play()
        TweenService:Create(disable, TweenInfo.new(0.5), {BackgroundTransparency = 0.5}):Play()
        disable.MouseButton1Click:Connect(function()
            if UserInputService:GetMouseLocation().Y + GuiInset.Y >= currentCodeBox.AbsolutePosition.Y and UserInputService:GetMouseLocation().Y + GuiInset.Y <= currentCodeBox.AbsolutePosition.Y + currentCodeBox.AbsoluteSize.Y and UserInputService:GetMouseLocation().X >= currentCodeBox.AbsolutePosition.X and UserInputService:GetMouseLocation().X <= currentCodeBox.AbsolutePosition.X + currentCodeBox.AbsoluteSize.X then
                return
            end
            TweenService:Create(currentCodeBox, TweenInfo.new(0.5), {Size = prevSize, Position = prevPos}):Play()
            TweenService:Create(disable, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
            wait(0.5)
            disable:Destroy()
            if currentTab == "rspy" then
                currentCodeBox.Size = UDim2.new(1, 0, 0.5, 0)
            else
                currentCodeBox.Size = UDim2.new(1, 0, 1, -30)
            end
            currentCodeBox.Position = UDim2.new(0, 0, 0, 0)
            currentCodeBox.ZIndex = 0
            maximized = false
        end)
    end
end

function isInResizeRange(p)
    local relativeP = p - Background.AbsolutePosition
    local range = 5
    if relativeP.X >= TopBar.AbsoluteSize.X - range and relativeP.Y >= Background.AbsoluteSize.Y - range
        and relativeP.X <= TopBar.AbsoluteSize.X and relativeP.Y <= Background.AbsoluteSize.Y then
        return true, 'B'
    elseif relativeP.X >= TopBar.AbsoluteSize.X - range and relativeP.X <= Background.AbsoluteSize.X then
        return true, 'X'
    elseif relativeP.Y >= Background.AbsoluteSize.Y - range and relativeP.Y <= Background.AbsoluteSize.Y then
        return true, 'Y'
    end
    return false
end

function isInDragRange(p)
    local relativeP = p - Background.AbsolutePosition
    local topbarAS = TopBar.AbsoluteSize
    return relativeP.X <= topbarAS.X - CloseButton.AbsoluteSize.X * 4 and relativeP.X >= 0 and relativeP.Y <= topbarAS.Y and relativeP.Y >= 0 or false
end

local customCursor = Create("ImageLabel",{Parent = SimpleSpy3,Visible = false,Size = UDim2.fromOffset(200, 200),ZIndex = 1e9,BackgroundTransparency = 1,Image = "",Parent = SimpleSpy3})
function mouseEntered()
    local con = connections["SIMPLESPY_CURSOR"]
    if con then
        con:Disconnect()
        connections["SIMPLESPY_CURSOR"] = nil
    end
    connections["SIMPLESPY_CURSOR"] = RunService.RenderStepped:Connect(function()
        UserInputService.MouseIconEnabled = not mouseInGui
        customCursor.Visible = mouseInGui
        if mouseInGui and getgenv().SimpleSpyExecuted then
            local mouseLocation = UserInputService:GetMouseLocation() - GuiInset
            customCursor.Position = UDim2.fromOffset(mouseLocation.X - customCursor.AbsoluteSize.X / 2, mouseLocation.Y - customCursor.AbsoluteSize.Y / 2)
            local inRange, type = isInResizeRange(mouseLocation)
            if inRange and not closed then
                if not sideClosed then
                    customCursor.Image = type == 'B' and "rbxassetid://6065821980" or type == 'X' and "rbxassetid://6065821086" or type == 'Y' and "rbxassetid://6065821596"
                elseif type == 'Y' or type == 'B' then
                    customCursor.Image = "rbxassetid://6065821596"
                end
            elseif customCursor.Image ~= "rbxassetid://6065775281" then
                customCursor.Image = "rbxassetid://6065775281"
            end
        else
            connections["SIMPLESPY_CURSOR"]:Disconnect()
        end
    end)
end

function mouseMoved()
    local mousePos = UserInputService:GetMouseLocation() - GuiInset
    if not closed
    and mousePos.X >= TopBar.AbsolutePosition.X and mousePos.X <= TopBar.AbsolutePosition.X + TopBar.AbsoluteSize.X
    and mousePos.Y >= Background.AbsolutePosition.Y and mousePos.Y <= Background.AbsolutePosition.Y + Background.AbsoluteSize.Y then
        if not mouseInGui then
            mouseInGui = true
            mouseEntered()
        end
    else
        mouseInGui = false
    end
end

function maximizeSize(speed)
    if not speed then
        speed = 0.05
    end
    local leftPanelWidth = tabsOpen and 181 or 131
    local currentLeftPanel = currentTab == "rspy" and LeftPanel or currentTab == "editor" and EditorLeftPanel or NotesLeftPanel
    local currentRightPanel = currentTab == "rspy" and RightPanel or currentTab == "editor" and EditorRightPanel or NotesRightPanel
    
    TweenService:Create(currentLeftPanel, TweenInfo.new(speed), { Size = UDim2.fromOffset(131, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y) }):Play()
    TweenService:Create(currentRightPanel, TweenInfo.new(speed), { Size = UDim2.fromOffset(Background.AbsoluteSize.X - leftPanelWidth, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y) }):Play()
    TweenService:Create(TopBar, TweenInfo.new(speed), { Size = UDim2.fromOffset(Background.AbsoluteSize.X, TopBar.AbsoluteSize.Y) }):Play()
    
    if currentTab == "rspy" then
        TweenService:Create(ScrollingFrame, TweenInfo.new(speed), { Size = UDim2.fromOffset(Background.AbsoluteSize.X - leftPanelWidth, 110), Position = UDim2.fromOffset(0, Background.AbsoluteSize.Y - 119 - TopBar.AbsoluteSize.Y) }):Play()
        TweenService:Create(CodeBox, TweenInfo.new(speed), { Size = UDim2.fromOffset(Background.AbsoluteSize.X - leftPanelWidth, Background.AbsoluteSize.Y - 119 - TopBar.AbsoluteSize.Y) }):Play()
    elseif currentTab == "editor" then
        TweenService:Create(EditorCodeBox, TweenInfo.new(speed), { Size = UDim2.fromOffset(Background.AbsoluteSize.X - leftPanelWidth, Background.AbsoluteSize.Y - 30 - TopBar.AbsoluteSize.Y) }):Play()
    else
        TweenService:Create(NotesCodeBox, TweenInfo.new(speed), { Size = UDim2.fromOffset(Background.AbsoluteSize.X - leftPanelWidth, Background.AbsoluteSize.Y - 30 - TopBar.AbsoluteSize.Y) }):Play()
    end
    
    TweenService:Create(LogList, TweenInfo.new(speed), { Size = UDim2.fromOffset(LogList.AbsoluteSize.X, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y - 18) }):Play()
    TweenService:Create(EditorList, TweenInfo.new(speed), { Size = UDim2.fromOffset(EditorList.AbsoluteSize.X, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y - 18) }):Play()
    TweenService:Create(NotesList, TweenInfo.new(speed), { Size = UDim2.fromOffset(NotesList.AbsoluteSize.X, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y - 48) }):Play()
end

function minimizeSize(speed)
    if not speed then
        speed = 0.05
    end
    local leftPanelWidth = tabsOpen and 181 or 131
    local currentLeftPanel = currentTab == "rspy" and LeftPanel or currentTab == "editor" and EditorLeftPanel or NotesLeftPanel
    local currentRightPanel = currentTab == "rspy" and RightPanel or currentTab == "editor" and EditorRightPanel or NotesRightPanel
    
    TweenService:Create(currentLeftPanel, TweenInfo.new(speed), { Size = UDim2.fromOffset(131, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y) }):Play()
    TweenService:Create(currentRightPanel, TweenInfo.new(speed), { Size = UDim2.fromOffset(0, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y) }):Play()
    TweenService:Create(TopBar, TweenInfo.new(speed), { Size = UDim2.fromOffset(leftPanelWidth, TopBar.AbsoluteSize.Y) }):Play()
    TweenService:Create(ScrollingFrame, TweenInfo.new(speed), { Size = UDim2.fromOffset(0, 119), Position = UDim2.fromOffset(0, Background.AbsoluteSize.Y - 119 - TopBar.AbsoluteSize.Y) }):Play()
    TweenService:Create(CodeBox, TweenInfo.new(speed), { Size = UDim2.fromOffset(0, Background.AbsoluteSize.Y - 119 - TopBar.AbsoluteSize.Y) }):Play()
    TweenService:Create(LogList, TweenInfo.new(speed), { Size = UDim2.fromOffset(LogList.AbsoluteSize.X, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y - 18) }):Play()
    TweenService:Create(EditorList, TweenInfo.new(speed), { Size = UDim2.fromOffset(EditorList.AbsoluteSize.X, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y - 18) }):Play()
    TweenService:Create(NotesList, TweenInfo.new(speed), { Size = UDim2.fromOffset(NotesList.AbsoluteSize.X, Background.AbsoluteSize.Y - TopBar.AbsoluteSize.Y - 48) }):Play()
end

function validateSize()
    local x, y = Background.AbsoluteSize.X, Background.AbsoluteSize.Y
    local screenSize = workspace.CurrentCamera.ViewportSize
    if x + Background.AbsolutePosition.X > screenSize.X then
        if screenSize.X - Background.AbsolutePosition.X >= 500 then
            x = screenSize.X - Background.AbsolutePosition.X
        else
            x = 500
        end
    elseif y + Background.AbsolutePosition.Y > screenSize.Y then
        if screenSize.X - Background.AbsolutePosition.Y >= 268 then
            y = screenSize.Y - Background.AbsolutePosition.Y
        else
            y = 268
        end
    end
    Background.Size = UDim2.fromOffset(x, y)
end

function backgroundUserInput(input)
    local mousePos = UserInputService:GetMouseLocation() - GuiInset
    local inResizeRange, type = isInResizeRange(mousePos)
    if input.UserInputType == Enum.UserInputType.MouseButton1 and inResizeRange then
        local lastPos = UserInputService:GetMouseLocation()
        local offset = Background.AbsoluteSize - lastPos
        local currentPos = lastPos + offset
        if not connections["SIMPLESPY_RESIZE"] then
            connections["SIMPLESPY_RESIZE"] = RunService.RenderStepped:Connect(function()
                local newPos = UserInputService:GetMouseLocation()
                if newPos ~= lastPos then
                    local currentX = (newPos + offset).X
                    local currentY = (newPos + offset).Y
                    if currentX < 500 then
                        currentX = 500
                    end
                    if currentY < 268 then
                        currentY = 268
                    end
                    currentPos = Vector2.new(currentX, currentY)
                    Background.Size = UDim2.fromOffset((not sideClosed and not closed and (type == "X" or type == "B")) and currentPos.X or Background.AbsoluteSize.X, (not closed and (type == "Y" or type == "B")) and currentPos.Y or Background.AbsoluteSize.Y)
                    validateSize()
                    if sideClosed then
                        minimizeSize()
                    else
                        maximizeSize()
                    end
                    lastPos = newPos
                end
            end)
        end
        table.insert(connections, UserInputService.InputEnded:Connect(function(inputE)
            if input == inputE then
                if connections["SIMPLESPY_RESIZE"] then
                    connections["SIMPLESPY_RESIZE"]:Disconnect()
                    connections["SIMPLESPY_RESIZE"] = nil
                end
            end
        end))
    elseif isInDragRange(mousePos) then
        onBarInput(input)
    end
end

function getPlayerFromInstance(instance)
    for _, v in next, Players:GetPlayers() do
        if v.Character and (instance:IsDescendantOf(v.Character) or instance == v.Character) then
            return v
        end
    end
end

function eventSelect(frame)
    if selected and selected.Log  then
        if selected.Button then
            spawn(function()
                TweenService:Create(selected.Button, TweenInfo.new(0.5), {BackgroundColor3 = Color3.fromRGB(0, 0, 0)}):Play()
            end)
        end
        selected = nil
    end
    for _, v in next, logs do
        if frame == v.Log then
            selected = v
        end
    end
    if selected and selected.Log then
        spawn(function()
            TweenService:Create(frame.Button, TweenInfo.new(0.5), {BackgroundColor3 = Color3.fromRGB(92, 126, 229)}):Play()
        end)
        codebox:setRaw(selected.GenScript)
    end
    if sideClosed then
        toggleSideTray()
    end
end

function updateFunctionCanvas()
    ScrollingFrame.CanvasSize = UDim2.fromOffset(UIGridLayout.AbsoluteContentSize.X, UIGridLayout.AbsoluteContentSize.Y)
end

function updateRemoteCanvas()
    LogList.CanvasSize = UDim2.fromOffset(UIListLayout.AbsoluteContentSize.X, UIListLayout.AbsoluteContentSize.Y)
end

function updateEditorCanvas()
    EditorList.CanvasSize = UDim2.fromOffset(EditorUIListLayout.AbsoluteContentSize.X, EditorUIListLayout.AbsoluteContentSize.Y)
end

function updateNotesCanvas()
    NotesList.CanvasSize = UDim2.fromOffset(NotesUIListLayout.AbsoluteContentSize.X, NotesUIListLayout.AbsoluteContentSize.Y)
end

function updateFileListCanvas()
    FileList.CanvasSize = UDim2.fromOffset(FileListLayout.AbsoluteContentSize.X, FileListLayout.AbsoluteContentSize.Y)
end

function makeToolTip(enable, text)
    if enable and text then
        if ToolTip.Visible then
            ToolTip.Visible = false
            local tooltip = connections["ToolTip"]
            if tooltip then
                tooltip:Disconnect()
            end
        end
        local first = true
        connections["ToolTip"] = RunService.RenderStepped:Connect(function()
            local MousePos = UserInputService:GetMouseLocation()
            local topLeft = MousePos + Vector2.new(20, -15)
            local bottomRight = topLeft + ToolTip.AbsoluteSize
            local ViewportSize = workspace.CurrentCamera.ViewportSize
            local ViewportSizeX = ViewportSize.X
            local ViewportSizeY = ViewportSize.Y

            if topLeft.X < 0 then
                topLeft = Vector2.new(0, topLeft.Y)
            elseif bottomRight.X > ViewportSizeX then
                topLeft = Vector2.new(ViewportSizeX - ToolTip.AbsoluteSize.X, topLeft.Y)
            end
            if topLeft.Y < 0 then
                topLeft = Vector2.new(topLeft.X, 0)
            elseif bottomRight.Y > ViewportSizeY - 35 then
                topLeft = Vector2.new(topLeft.X, ViewportSizeY - ToolTip.AbsoluteSize.Y - 35)
            end
            if topLeft.X <= MousePos.X and topLeft.Y <= MousePos.Y then
                topLeft = Vector2.new(MousePos.X - ToolTip.AbsoluteSize.X - 2, MousePos.Y - ToolTip.AbsoluteSize.Y - 2)
            end
            if first then
                ToolTip.Position = UDim2.fromOffset(topLeft.X, topLeft.Y)
                first = false
            else
                ToolTip:TweenPosition(UDim2.fromOffset(topLeft.X, topLeft.Y), "Out", "Linear", 0.1)
            end
        end)
        TextLabel.Text = text
        TextLabel.TextScaled = true
        ToolTip.Visible = true
        return
    else
        if ToolTip.Visible then
            ToolTip.Visible = false
            local tooltip = connections["ToolTip"]
            if tooltip then
                tooltip:Disconnect()
            end
        end
    end
end

local newButton = UIGenModule.newButton(ScrollingFrame, TweenService, Create, makeToolTip, logthread, running, updateFunctionCanvas)
local newRemote = UIGenModule.newRemote(LogList, Create, TweenService, layoutOrderNum, updateRemoteCanvas, remoteLogs, logs, clean)

function genScript(remote, args)
    prevTables = {}
    local gen = ""
    if #args > 0 then
        xpcall(function()
            gen = "local args = "..LazyFix.Convert(args, true) .. "\n"
        end,function(err)
            gen ..= "\nlocal args = {"
            xpcall(function()
                for i, v in next, args do
                    if type(i) ~= "Instance" and type(i) ~= "userdata" then
                        gen = gen .. "\n    [object] = "
                    elseif type(i) == "string" then
                        gen = gen .. '\n    ["' .. i .. '"] = '
                    elseif type(i) == "userdata" and typeof(i) ~= "Instance" then
                        gen = gen .. "\n    [" .. string.format("nil", typeof(v)) .. ")] = "
                    elseif type(i) == "userdata" then
                         gen = gen .. "\n    [game." .. i:GetFullName() .. ")] = "
                    end
                    if type(v) ~= "Instance" and type(v) ~= "userdata" then
                        gen = gen .. "object"
                    elseif type(v) == "string" then
                        gen = gen .. '"' .. v .. '"'
                    elseif type(v) == "userdata" and typeof(v) ~= "Instance" then
                        gen = gen .. string.format("nil", typeof(v))
                    elseif type(v) == "userdata" then
                        gen = gen .. "game." .. v:GetFullName()
                    end
                end
                gen ..= "\n}\n\n"
            end,function()
                gen ..= "}\n"
            end)
        end)
        if not remote:IsDescendantOf(game) and not getnilrequired then
            gen = "function getNil(name,class) for _,v in next, getnilinstances()do if v.ClassName==class and v.Name==name then return v;end end end\n\n" .. gen
        end
        if remote:IsA("RemoteEvent") or remote:IsA("UnreliableRemoteEvent") then
            gen ..= LazyFix.ConvertKnown("Instance", remote) .. ":FireServer(unpack(args))"
        elseif remote:IsA("RemoteFunction") then
            gen = gen .. LazyFix.ConvertKnown("Instance", remote) .. ":InvokeServer(unpack(args))"
        end
    else
        if remote:IsA("RemoteEvent") or remote:IsA("UnreliableRemoteEvent") then
            gen ..= LazyFix.ConvertKnown("Instance", remote) .. ":FireServer()"
        elseif remote:IsA("RemoteFunction") then
            gen ..= LazyFix.ConvertKnown("Instance", remote) .. ":InvokeServer()"
        end
    end
    prevTables = {}
    return gen
end

local CustomGeneration = {
    Vector3 = (function()
        local temp = {}
        for i,v in Vector3 do
            if type(v) == "vector" then
                temp[v] = `Vector3.{i}`
            end
        end
        return temp
    end)(),
    Vector2 = (function()
        local temp = {}
        for i,v in Vector2 do
            if type(v) == "userdata" then
                temp[v] = `Vector2.{i}`
            end
        end
        return temp
    end)(),
    CFrame = {
        [CFrame.identity] = "CFrame.identity"
    }
}

local number_table = {
    ["inf"] = "math.huge",
    ["-inf"] = "-math.huge",
    ["nan"] = "0/0"
}

local ufunctions
ufunctions = {
    TweenInfo = function(u)
        return `TweenInfo.new({u.Time}, {u.EasingStyle}, {u.EasingDirection}, {u.RepeatCount}, {u.Reverses}, {u.DelayTime})`
    end,
    Ray = function(u)
        local Vector3tostring = ufunctions["Vector3"]

        return `Ray.new({Vector3tostring(u.Origin)}, {Vector3tostring(u.Direction)})`
    end,
    BrickColor = function(u)
        return `BrickColor.new({u.Number})`
    end,
    NumberRange = function(u)
        return `NumberRange.new({u.Min}, {u.Max})`
    end,
    Region3 = function(u)
        local center = u.CFrame.Position
        local centersize = u.Size/2
        local Vector3tostring = ufunctions["Vector3"]

        return `Region3.new({Vector3tostring(center-centersize)}, {Vector3tostring(center+centersize)})`
    end,
    Faces = function(u)
        local faces = {}
        if u.Top then
            table.insert(faces, "Top")
        end
        if u.Bottom then
            table.insert(faces, "Enum.NormalId.Bottom")
        end
        if u.Left then
            table.insert(faces, "Enum.NormalId.Left")
        end
        if u.Right then
            table.insert(faces, "Enum.NormalId.Right")
        end
        if u.Back then
            table.insert(faces, "Enum.NormalId.Back")
        end
        if u.Front then
            table.insert(faces, "Enum.NormalId.Front")
        end
        return `Faces.new({table.concat(faces, ", ")})`
    end,
    EnumItem = function(u)
        return tostring(u)
    end,
    Enums = function(u)
        return "Enum"
    end,
    Enum = function(u)
        return `Enum.{u}`
    end,
    Vector3 = function(u)
        return CustomGeneration.Vector3[u] or `Vector3.new({u})`
    end,
    Vector2 = function(u)
        return CustomGeneration.Vector2[u] or `Vector2.new({u})`
    end,
    CFrame = function(u)
        return CustomGeneration.CFrame[u] or `CFrame.new({table.concat({u:GetComponents()},", ")})`
    end,
    PathWaypoint = function(u)
        return `PathWaypoint.new({ufunctions["Vector3"](u.Position)}, {u.Action}, "{u.Label}")`
    end,
    UDim = function(u)
        return `UDim.new({u})`
    end,
    UDim2 = function(u)
        return `UDim2.new({u})`
    end,
    Rect = function(u)
        local Vector2tostring = ufunctions["Vector2"]
        return `Rect.new({Vector2tostring(u.Min)}, {Vector2tostring(u.Max)})`
    end,
    Color3 = function(u)
        return `Color3.new({u.R}, {u.G}, {u.B})`
    end,
    RBXScriptSignal = function(u)
        return "RBXScriptSignal"
    end,
    RBXScriptConnection = function(u)
        return "RBXScriptConnection"
    end,
}

local typeofv2sfunctions
local typev2sfunctions

typeofv2sfunctions = {
    number = function(v)
        local number = tostring(v)
        return number_table[number] or number
    end,
    boolean = function(v)
        return tostring(v)
    end,
    string = function(v,l)
        return formatstr(v, l)
    end,
    ["function"] = function(v)
        return f2s(v)
    end,
    table = function(v, l, p, n, vtv, i, pt, path, tables, tI)
        return t2s(v, l, p, n, vtv, i, pt, path, tables, tI)
    end,
    Instance = function(v)
        local DebugId = OldDebugId(v)
        return i2p(v,generation[DebugId])
    end,
    userdata = function(v)
        if configs.advancedinfo then
            if getrawmetatable(v) then
                return "newproxy(true)"
            end
            return "newproxy(false)"
        end
        return "newproxy(true)"
    end
}

typev2sfunctions = {
    userdata = function(v,vtypeof)
        if ufunctions[vtypeof] then
            return ufunctions[vtypeof](v)
        end
        return `{vtypeof}({rawtostring(v)})`
    end,
    vector = ufunctions["Vector3"]
}

function v2s(v, l, p, n, vtv, i, pt, path, tables, tI)
    return CodeGenModule.v2s(v, l, p, n, vtv, i, pt, path, tables, tI, typeofv2sfunctions, typev2sfunctions)
end

function t2s(t, l, p, n, vtv, i, pt, path, tables, tI)
    return CodeGenModule.t2s(t, l, p, n, vtv, i, pt, path, tables, tI, v2s, v2p, scheduleWait, indent, getgenv, rawtostring)
end

function f2s(f)
    return CodeGenModule.f2s(f, info, getgenv, v2p, v2s, configs)
end

function i2p(i,customgen)
    return CodeGenModule.i2p(i, customgen, getplayer, game, Players, SafeGetService, formatstr, getnilrequired)
end

function getplayer(instance)
    for _, v in next, Players:GetPlayers() do
        if v.Character and (instance:IsDescendantOf(v.Character) or instance == v.Character) then
            return v
        end
    end
end

function v2p(x, t, path, prev)
    return CodeGenModule.v2p(x, t, path, prev, v2s)
end

function formatstr(s, indentation)
    return CodeGenModule.formatstr(s, indentation, handlespecials)
end

function handlespecials(s, indentation)
    return CodeGenModule.handlespecials(s, indentation, string, create, resume, status, RunService, clear, getgenv)
end

function v2v(t)
    topstr = ""
    bottomstr = ""
    getnilrequired = false
    local ret = ""
    local count = 1
    for i, v in next, t do
        if type(i) == "string" and i:match("^[%a_]+[%w_]*$") then
            ret = ret .. "local " .. i .. " = " .. v2s(v, nil, nil, i, true) .. "\n"
        elseif rawtostring(i):match("^[%a_]+[%w_]*$") then
            ret = ret .. "local " .. lower(rawtostring(i)) .. "_" .. rawtostring(count) .. " = " .. v2s(v, nil, nil, lower(rawtostring(i)) .. "_" .. rawtostring(count), true) .. "\n"
        else
            ret = ret .. "local " .. type(v) .. "_" .. rawtostring(count) .. " = " .. v2s(v, nil, nil, type(v) .. "_" .. rawtostring(count), true) .. "\n"
        end
        count = count + 1
    end
    if getnilrequired then
        topstr = "function getNil(name,class) for _,v in next, getnilinstances() do if v.ClassName==class and v.Name==name then return v;end end end\n" .. topstr
    end
    if #topstr > 0 then
        ret = topstr .. "\n" .. ret
    end
    if #bottomstr > 0 then
        ret = ret .. bottomstr
    end
    return ret
end

function getScriptFromSrc(src)
    local realPath
    local runningTest
    local s, e
    local match = false
    if src:sub(1, 1) == "=" then
        realPath = game
        s = 2
    else
        runningTest = src:sub(2, e and e - 1 or -1)
        for _, v in next, getnilinstances() do
            if v.Name == runningTest then
                realPath = v
                break
            end
        end
        s = #runningTest + 1
    end
    if realPath then
        e = src:sub(s, -1):find("%.")
        local i = 0
        repeat
            i += 1
            if not e then
                runningTest = src:sub(s, -1)
                local test = realPath.FindFirstChild(realPath, runningTest)
                if test then
                    realPath = test
                end
                match = true
            else
                runningTest = src:sub(s, e)
                local test = realPath.FindFirstChild(realPath, runningTest)
                local yeOld = e
                if test then
                    realPath = test
                    s = e + 2
                    e = src:sub(e + 2, -1):find("%.")
                    e = e and e + yeOld or e
                else
                    e = src:sub(e + 2, -1):find("%.")
                    e = e and e + yeOld or e
                end
            end
        until match or i >= 50
    end
    return realPath
end

function schedule(f, ...)
    table.insert(scheduled, {f, ...})
end

function scheduleWait()
    local thread = running()
    schedule(function()
        resume(thread)
    end)
    yield()
end

local function taskscheduler()
    if not toggle then
        scheduled = {}
        return
    end
    if #scheduled > SIMPLESPYCONFIG_MaxRemotes + 100 then
        table.remove(scheduled, #scheduled)
    end
    if #scheduled > 0 then
        local currentf = scheduled[1]
        table.remove(scheduled, 1)
        if type(currentf) == "table" and type(currentf[1]) == "function" then
            pcall(unpack(currentf))
        end
    end
end

local function tablecheck(tabletocheck,instance,id)
    return tabletocheck[id] or tabletocheck[instance.Name]
end

function remoteHandler(data)
    if configs.autoblock then
        local id = data.id

        if excluding[id] then
            return
        end
        if not history[id] then
            history[id] = {badOccurances = 0, lastCall = tick()}
        end
        if tick() - history[id].lastCall < 1 then
            history[id].badOccurances += 1
            return
        else
            history[id].badOccurances = 0
        end
        if history[id].badOccurances > 3 then
            excluding[id] = true
            return
        end
        history[id].lastCall = tick()
    end

    if (data.remote:IsA("RemoteEvent") or data.remote:IsA("UnreliableRemoteEvent")) and lower(data.method) == "fireserver" then
        newRemote("event", data)
    elseif data.remote:IsA("RemoteFunction") and lower(data.method) == "invokeserver" then
        newRemote("function", data)
    end
end

local function newindex(method,originalfunction,...)
    if typeof(...) == 'Instance' then
        local remote = cloneref(...)

        if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") or remote:IsA("UnreliableRemoteEvent") then
            if not configs.logcheckcaller and checkcaller and checkcaller() then return originalfunction(...) end
            local id = ThreadGetDebugId(remote)
            local blockcheck = tablecheck(blocklist,remote,id)
            local args = {select(2,...)}

            if not tablecheck(blacklist,remote,id) and not IsCyclicTable(args) then
                local infofunc = nil
                local callingscript = nil
                
                if configs.funcEnabled then
                    infofunc = info(2,"f")
                    local calling = getcallingscript and getcallingscript()
                    callingscript = calling and cloneref(calling) or nil
                end
                
                local data = {
                    method = method,
                    remote = remote,
                    args = deepclone(args),
                    infofunc = infofunc,
                    callingscript = callingscript,
                    metamethod = "__index",
                    blocked = blockcheck,
                    id = id,
                    returnvalue = {}
                }
                args = nil

                schedule(remoteHandler,data)
            end
            if blockcheck then return end
        end
    end
    return originalfunction(...)
end

local newnamecall = newcclosure(function(...)
    local method = getnamecallmethod()

    if method and (lower(method) == "fireserver" or lower(method) == "invokeserver") then
        if typeof(...) == 'Instance' then
            local remote = cloneref(...)

            if IsA(remote,"RemoteEvent") or IsA(remote,"RemoteFunction") or IsA(remote,"UnreliableRemoteEvent") then    
                if not configs.logcheckcaller and checkcaller and checkcaller() then return originalnamecall(...) end
                local id = ThreadGetDebugId(remote)
                local blockcheck = tablecheck(blocklist,remote,id)
                local args = {select(2,...)}

                if not tablecheck(blacklist,remote,id) and not IsCyclicTable(args) then
                    local infofunc = nil
                    local callingscript = nil
                    
                    if configs.funcEnabled then
                        infofunc = info(2,"f")
                        local calling = getcallingscript and getcallingscript()
                        if calling and type(calling) == "userdata" then
                            callingscript = cloneref(calling)
                        end
                    end
                    
                    local data = {
                        method = method,
                        remote = remote,
                        args = deepclone(args),
                        infofunc = infofunc,
                        callingscript = callingscript,
                        metamethod = "__namecall",
                        blocked = blockcheck,
                        id = id,
                        returnvalue = {}
                    }
                    args = nil

                    schedule(remoteHandler,data)
                end
                if blockcheck then return end
            end
        end
    end
    return originalnamecall(...)
end)

function toggleSpy()
    if not toggle then
        local oldnamecall
        if synv3 then
            oldnamecall = hook(getrawmetatable(game).__namecall,clonefunction(newnamecall))
            originalEvent = hook(Instance.new("RemoteEvent").FireServer, function(...)
                return newindex("FireServer",originalEvent,...)
            end)
            originalFunction = hook(Instance.new("RemoteFunction").InvokeServer, function(...)
                return newindex("InvokeServer",originalFunction,...)
            end)
            originalUnreliableEvent = hook(Instance.new("UnreliableRemoteEvent").FireServer, function(...)
                return newindex("FireServer",originalUnreliableEvent,...)
            end)
        else
            if hookmetamethod then
                oldnamecall = hookmetamethod(game, "__namecall", clonefunction(newnamecall))
            else
                oldnamecall = hookfunction(getrawmetatable(game).__namecall,clonefunction(newnamecall))
            end
            originalEvent = hookfunction(Instance.new("RemoteEvent").FireServer, function(...)
                return newindex("FireServer",originalEvent,...)
            end)
            originalFunction = hookfunction(Instance.new("RemoteFunction").InvokeServer, function(...)
                return newindex("InvokeServer",originalFunction,...)
            end)
            originalUnreliableEvent = hookfunction(Instance.new("UnreliableRemoteEvent").FireServer, function(...)
                return newindex("FireServer",originalUnreliableEvent,...)
            end)
        end
        originalnamecall = originalnamecall or function(...)
            return oldnamecall(...)
        end
    else
        HookModule.disableHooks(synv3, hookmetamethod, hookfunction, getrawmetatable, game, originalnamecall, originalEvent, originalFunction, originalUnreliableEvent, unhook, restorefunction)
    end
end

function toggleSpyMethod()
    toggleSpy()
    toggle = not toggle
end

function switchTab(tab)
    currentTab = tab
    
    LeftPanel.Visible = tab == "rspy"
    RightPanel.Visible = tab == "rspy"
    EditorLeftPanel.Visible = tab == "editor"
    EditorRightPanel.Visible = tab == "editor"
    NotesLeftPanel.Visible = tab == "notes"
    NotesRightPanel.Visible = tab == "notes"
    
    RSpyTab.BackgroundColor3 = tab == "rspy" and Color3.fromRGB(92, 126, 229) or Color3.fromRGB(45, 45, 48)
    EditorTab.BackgroundColor3 = tab == "editor" and Color3.fromRGB(92, 126, 229) or Color3.fromRGB(45, 45, 48)
    NotesTab.BackgroundColor3 = tab == "notes" and Color3.fromRGB(92, 126, 229) or Color3.fromRGB(45, 45, 48)
    
    if not sideClosed then
        maximizeSize()
    end
end

function toggleTabSidebar()
    tabsOpen = not tabsOpen
    configs.tabsOpen = tabsOpen
    
    local targetPos = tabsOpen and UDim2.new(0, 0, 0, 19) or UDim2.new(0, -50, 0, 19)
    local leftPanelPos = tabsOpen and UDim2.new(0, 50, 0, 19) or UDim2.new(0, 0, 0, 19)
    local rightPanelPos = tabsOpen and UDim2.new(0, 181, 0, 19) or UDim2.new(0, 131, 0, 19)
    
    TweenService:Create(TabSidebar, TweenInfo.new(0.3), {Position = targetPos}):Play()
    TweenService:Create(LeftPanel, TweenInfo.new(0.3), {Position = leftPanelPos}):Play()
    TweenService:Create(EditorLeftPanel, TweenInfo.new(0.3), {Position = leftPanelPos}):Play()
    TweenService:Create(NotesLeftPanel, TweenInfo.new(0.3), {Position = leftPanelPos}):Play()
    TweenService:Create(RightPanel, TweenInfo.new(0.3), {Position = rightPanelPos}):Play()
    TweenService:Create(EditorRightPanel, TweenInfo.new(0.3), {Position = rightPanelPos}):Play()
    TweenService:Create(NotesRightPanel, TweenInfo.new(0.3), {Position = rightPanelPos}):Play()
    
    wait(0.3)
    maximizeSize()
end

function selectEditorTab(tabData)
    if not tabData then return end
    
    if selectedEditorTab and selectedEditorTab.button then
        pcall(function()
            TweenService:Create(selectedEditorTab.button, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(0, 0, 0)}):Play()
        end)
    end
    
    selectedEditorTab = tabData
    
    pcall(function()
        TweenService:Create(tabData.button, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(92, 126, 229)}):Play()
    end)
    
    EditorTextBox.Text = tabData.text or ""
end

function createEditorTab(remoteName, code)
    local tabId = #editorTabs + 1
    
    local EditorTabFrame = Create("Frame",{Name = "EditorTab",Parent = EditorList,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Size = UDim2.new(0, 117, 0, 27)})
    local ColorBar = Create("Frame",{Name = "ColorBar",Parent = EditorTabFrame,BackgroundColor3 = Color3.fromRGB(68, 206, 91),BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 1),Size = UDim2.new(0, 7, 0, 18),ZIndex = 2})
    local Text = Create("TextLabel",{TextTruncate = Enum.TextTruncate.AtEnd,Name = "Text",Parent = EditorTabFrame,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 12, 0, 1),Size = UDim2.new(0, 85, 0, 18),ZIndex = 2,Font = Enum.Font.SourceSans,Text = remoteName,TextColor3 = Color3.new(1, 1, 1),TextSize = 14,TextXAlignment = Enum.TextXAlignment.Left})
    local Button = Create("TextButton",{Name = "Button",Parent = EditorTabFrame,BackgroundColor3 = Color3.new(0, 0, 0),BackgroundTransparency = 0.75,BorderColor3 = Color3.new(1, 1, 1),Position = UDim2.new(0, 0, 0, 1),Size = UDim2.new(0, 97, 0, 18),AutoButtonColor = false,Font = Enum.Font.SourceSans,Text = "",TextColor3 = Color3.new(0, 0, 0),TextSize = 14})
    local CloseBtn = Create("TextButton",{Name = "CloseBtn",Parent = EditorTabFrame,BackgroundColor3 = Color3.fromRGB(252, 51, 51),BorderSizePixel = 0,Position = UDim2.new(0, 97, 0, 1),Size = UDim2.new(0, 20, 0, 18),Font = Enum.Font.SourceSansBold,Text = "X",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,AutoButtonColor = false})
    
    local tabData = {
        id = tabId,
        frame = EditorTabFrame,
        button = Button,
        closeBtn = CloseBtn,
        text = code,
        remoteName = remoteName,
        textLabel = Text
    }
    
    editorTabs[tabId] = tabData
    
    Button.MouseButton1Click:Connect(function()
        selectEditorTab(tabData)
    end)
    
    CloseBtn.MouseButton1Click:Connect(function()
        pcall(function()
            EditorTabFrame:Destroy()
        end)
        
        editorTabs[tabId] = nil
        
        if selectedEditorTab and selectedEditorTab.id == tabId then
            selectedEditorTab = nil
            EditorTextBox.Text = ""
            
            local nextTab = next(editorTabs)
            if nextTab then
                selectEditorTab(editorTabs[nextTab])
            end
        end
        
        updateEditorCanvas()
    end)
    
    if not selectedEditorTab then
        selectEditorTab(tabData)
    end
    
    updateEditorCanvas()
    return tabData
end

function selectNotesTab(noteData)
    if not noteData then return end
    
    if selectedNotesTab and selectedNotesTab.button then
        pcall(function()
            TweenService:Create(selectedNotesTab.button, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(0, 0, 0)}):Play()
        end)
    end
    
    selectedNotesTab = noteData
    
    pcall(function()
        TweenService:Create(noteData.button, TweenInfo.new(0.3), {BackgroundColor3 = Color3.fromRGB(92, 126, 229)}):Play()
    end)
    
    NotesTextBox.Text = noteData.text or ""
end

function createNote(noteName, noteText)
    local noteId = #notesTabs + 1
    
    local NoteTabFrame = Create("Frame",{Name = "NoteTab",Parent = NotesList,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Size = UDim2.new(0, 117, 0, 27)})
    local ColorBar = Create("Frame",{Name = "ColorBar",Parent = NoteTabFrame,BackgroundColor3 = Color3.fromRGB(255, 200, 60),BorderSizePixel = 0,Position = UDim2.new(0, 0, 0, 1),Size = UDim2.new(0, 7, 0, 18),ZIndex = 2})
    local Text = Create("TextLabel",{TextTruncate = Enum.TextTruncate.AtEnd,Name = "Text",Parent = NoteTabFrame,BackgroundColor3 = Color3.new(1, 1, 1),BackgroundTransparency = 1,Position = UDim2.new(0, 12, 0, 1),Size = UDim2.new(0, 105, 0, 18),ZIndex = 2,Font = Enum.Font.SourceSans,Text = noteName,TextColor3 = Color3.new(1, 1, 1),TextSize = 14,TextXAlignment = Enum.TextXAlignment.Left})
    local Button = Create("TextButton",{Name = "Button",Parent = NoteTabFrame,BackgroundColor3 = Color3.new(0, 0, 0),BackgroundTransparency = 0.75,BorderColor3 = Color3.new(1, 1, 1),Position = UDim2.new(0, 0, 0, 1),Size = UDim2.new(0, 117, 0, 18),AutoButtonColor = false,Font = Enum.Font.SourceSans,Text = "",TextColor3 = Color3.new(0, 0, 0),TextSize = 14})
    
    local noteData = {
        id = noteId,
        frame = NoteTabFrame,
        button = Button,
        text = noteText or "",
        noteName = noteName,
        filePath = nil,
        textLabel = Text
    }
    
    notesTabs[noteId] = noteData
    
    Button.MouseButton1Click:Connect(function()
        selectNotesTab(noteData)
    end)
    
    if not selectedNotesTab then
        selectNotesTab(noteData)
    end
    
    updateNotesCanvas()
    return noteData
end

function getGameName()
    local success, gameName = pcall(function()
        return MarketplaceService:GetProductInfo(game.PlaceId).Name:gsub("[^%w%s]", "")
    end)
    return success and gameName or "UnknownGame"
end

function saveNote()
    if not selectedNotesTab then
        TextLabel.Text = "No note selected!"
        return
    end
    
    if not isfolder or not writefile or not makefolder then
        TextLabel.Text = "File functions not supported!"
        return
    end
    
    pcall(function()
        selectedNotesTab.text = NotesTextBox.Text
        
        local gameName = getGameName()
        
        if not isfolder("Rspy V3 notes") then
            makefolder("Rspy V3 notes")
        end
        
        if not isfolder("Rspy V3 notes/" .. gameName) then
            makefolder("Rspy V3 notes/" .. gameName)
        end
        
        local fileName = selectedNotesTab.noteName
        local filePath = "Rspy V3 notes/" .. gameName .. "/" .. fileName .. ".txt"
        local counter = 1
        
        while isfile(filePath) and selectedNotesTab.filePath ~= filePath do
            filePath = "Rspy V3 notes/" .. gameName .. "/" .. fileName .. " (" .. counter .. ").txt"
            counter = counter + 1
        end
        
        writefile(filePath, selectedNotesTab.text)
        selectedNotesTab.filePath = filePath
        TextLabel.Text = "Note saved: " .. fileName
    end)
end

function deleteNote()
    if not selectedNotesTab then
        TextLabel.Text = "No note selected!"
        return
    end
    
    pcall(function()
        local noteId = selectedNotesTab.id
        
        if selectedNotesTab.filePath and isfile and delfile and isfile(selectedNotesTab.filePath) then
            delfile(selectedNotesTab.filePath)
        end
        
        selectedNotesTab.frame:Destroy()
        notesTabs[noteId] = nil
        
        local nextNote = next(notesTabs)
        if nextNote then
            selectNotesTab(notesTabs[nextNote])
        else
            selectedNotesTab = nil
            NotesTextBox.Text = ""
        end
        
        updateNotesCanvas()
        TextLabel.Text = "Note deleted!"
    end)
end

function showFileBrowser()
    if not isfolder or not isfile or not listfiles then
        TextLabel.Text = "File functions not supported!"
        return
    end
    
    pcall(function()
        for _, child in pairs(FileList:GetChildren()) do
            if not child:IsA("UIListLayout") then
                child:Destroy()
            end
        end
        
        local gameName = getGameName()
        local notesPath = "Rspy V3 notes/" .. gameName
        
        if not isfolder(notesPath) then
            makefolder("Rspy V3 notes")
            makefolder(notesPath)
        end
        
        local files = listfiles(notesPath)
        
        if #files == 0 then
            local NoFilesLabel = Create("TextLabel",{Parent = FileList,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Size = UDim2.new(1, -10, 0, 30),Font = Enum.Font.SourceSans,Text = "No saved notes found",TextColor3 = Color3.new(0.7, 0.7, 0.7),TextSize = 14,ZIndex = 10})
        else
            for _, filePath in pairs(files) do
                if filePath:match("%.txt$") then
                    local fileName = filePath:match("([^/\\]+)%.txt$")
                    
                    local FileButton = Create("TextButton",{Parent = FileList,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Size = UDim2.new(1, -10, 0, 30),Font = Enum.Font.SourceSans,Text = fileName,TextColor3 = Color3.new(1, 1, 1),TextSize = 14,TextXAlignment = Enum.TextXAlignment.Left,ZIndex = 10,AutoButtonColor = false})
                    
                    local Padding = Create("UIPadding",{Parent = FileButton,PaddingLeft = UDim.new(0, 10)})
                    
                    FileButton.MouseButton1Click:Connect(function()
                        pcall(function()
                            local content = readfile(filePath)
                            createNote(fileName, content)
                            FileBrowser.Visible = false
                            TextLabel.Text = "Loaded: " .. fileName
                        end)
                    end)
                    
                    FileButton.MouseEnter:Connect(function()
                        TweenService:Create(FileButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(92, 126, 229)}):Play()
                    end)
                    
                    FileButton.MouseLeave:Connect(function()
                        TweenService:Create(FileButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(45, 45, 48)}):Play()
                    end)
                end
            end
        end
        
        updateFileListCanvas()
        FileBrowser.Visible = true
    end)
end

function renameEditorTab()
    if not selectedEditorTab then
        TextLabel.Text = "No editor tab selected!"
        return
    end
    
    pcall(function()
        local newName = selectedEditorTab.remoteName
        
        local RenameFrame = Create("Frame",{Parent = SimpleSpy3,BackgroundColor3 = Color3.fromRGB(30, 30, 32),BorderSizePixel = 1,BorderColor3 = Color3.new(1, 1, 1),Position = UDim2.new(0.5, -100, 0.5, -40),Size = UDim2.new(0, 200, 0, 80),ZIndex = 15})
        local RenameTitle = Create("TextLabel",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Size = UDim2.new(1, 0, 0, 25),Font = Enum.Font.SourceSansBold,Text = "Rename Tab",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ZIndex = 15})
        local RenameInput = Create("TextBox",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(37, 36, 38),BorderSizePixel = 0,Position = UDim2.new(0, 10, 0, 30),Size = UDim2.new(1, -20, 0, 20),Font = Enum.Font.SourceSans,Text = newName,TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ClearTextOnFocus = false,ZIndex = 15})
        local RenameOK = Create("TextButton",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(68, 206, 91),BorderSizePixel = 0,Position = UDim2.new(0, 10, 1, -25),Size = UDim2.new(0, 85, 0, 20),Font = Enum.Font.SourceSansBold,Text = "OK",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ZIndex = 15})
        local RenameCancel = Create("TextButton",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(252, 51, 51),BorderSizePixel = 0,Position = UDim2.new(1, -95, 1, -25),Size = UDim2.new(0, 85, 0, 20),Font = Enum.Font.SourceSansBold,Text = "Cancel",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ZIndex = 15})
        
        RenameOK.MouseButton1Click:Connect(function()
            selectedEditorTab.remoteName = RenameInput.Text
            selectedEditorTab.textLabel.Text = RenameInput.Text
            RenameFrame:Destroy()
            TextLabel.Text = "Renamed to: " .. RenameInput.Text
        end)
        
        RenameCancel.MouseButton1Click:Connect(function()
            RenameFrame:Destroy()
        end)
    end)
end

function renameNotesTab()
    if not selectedNotesTab then
        TextLabel.Text = "No note selected!"
        return
    end
    
    pcall(function()
        local newName = selectedNotesTab.noteName
        
        local RenameFrame = Create("Frame",{Parent = SimpleSpy3,BackgroundColor3 = Color3.fromRGB(30, 30, 32),BorderSizePixel = 1,BorderColor3 = Color3.new(1, 1, 1),Position = UDim2.new(0.5, -100, 0.5, -40),Size = UDim2.new(0, 200, 0, 80),ZIndex = 15})
        local RenameTitle = Create("TextLabel",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(45, 45, 48),BorderSizePixel = 0,Size = UDim2.new(1, 0, 0, 25),Font = Enum.Font.SourceSansBold,Text = "Rename Note",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ZIndex = 15})
        local RenameInput = Create("TextBox",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(37, 36, 38),BorderSizePixel = 0,Position = UDim2.new(0, 10, 0, 30),Size = UDim2.new(1, -20, 0, 20),Font = Enum.Font.SourceSans,Text = newName,TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ClearTextOnFocus = false,ZIndex = 15})
        local RenameOK = Create("TextButton",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(68, 206, 91),BorderSizePixel = 0,Position = UDim2.new(0, 10, 1, -25),Size = UDim2.new(0, 85, 0, 20),Font = Enum.Font.SourceSansBold,Text = "OK",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ZIndex = 15})
        local RenameCancel = Create("TextButton",{Parent = RenameFrame,BackgroundColor3 = Color3.fromRGB(252, 51, 51),BorderSizePixel = 0,Position = UDim2.new(1, -95, 1, -25),Size = UDim2.new(0, 85, 0, 20),Font = Enum.Font.SourceSansBold,Text = "Cancel",TextColor3 = Color3.new(1, 1, 1),TextSize = 14,ZIndex = 15})
        
        RenameOK.MouseButton1Click:Connect(function()
            selectedNotesTab.noteName = RenameInput.Text
            selectedNotesTab.textLabel.Text = RenameInput.Text
            RenameFrame:Destroy()
            TextLabel.Text = "Renamed to: " .. RenameInput.Text
        end)
        
        RenameCancel.MouseButton1Click:Connect(function()
            RenameFrame:Destroy()
        end)
    end)
end

local function shutdown()
    schedulerconnect = CleanupModule.cleanupScheduler(schedulerconnect)
    CleanupModule.cleanupConnections(connections)
    CleanupModule.cleanupThreads(running_threads)
    CleanupModule.cleanupLogs(logs)
    CleanupModule.cleanupRemoteLogs(remoteLogs)
    pcall(function()
        HookModule.disableHooks(synv3, hookmetamethod, hookfunction, getrawmetatable, game, originalnamecall, originalEvent, originalFunction, originalUnreliableEvent, unhook, restorefunction)
    end)
    CleanupModule.cleanupGUI(SimpleSpy3, Storage)
    CleanupModule.restoreMouse()
    
    getgenv().SimpleSpyExecuted = false
    getgenv().SimpleSpyShutdown = nil
end

if not getgenv().SimpleSpyExecuted then
    local succeeded,err = pcall(function()
        if not RunService:IsClient() then
            error("SimpleSpy cannot run on the server!")
        end
        getgenv().SimpleSpyShutdown = shutdown
        onToggleButtonClick()
        if not hookmetamethod then
            ErrorPrompt("Simple Spy V4 will not function to it's fullest capablity due to your executor not supporting hookmetamethod.",true)
        end
        codebox = Highlight.new(CodeBox)
        logthread(spawn(function()
            local suc,err = pcall(game.HttpGet,game,"https://raw.githubusercontent.com/infyiff/backup/refs/heads/main/SimpleSpyV3/update.txt")
            codebox:setRaw((suc and err) or "")
        end))
        getgenv().SimpleSpy = SimpleSpy
        getgenv().getNil = function(name,class)
            for _,v in next, getnilinstances() do
                if v.ClassName == class and v.Name == name then
                    return v;
                end
            end
        end
        
        RSpyTab.MouseButton1Click:Connect(function()
            switchTab("rspy")
        end)
        
        EditorTab.MouseButton1Click:Connect(function()
            switchTab("editor")
        end)
        
        NotesTab.MouseButton1Click:Connect(function()
            switchTab("notes")
        end)
        
        TabToggleButton.MouseButton1Click:Connect(toggleTabSidebar)
        
        local isUpdatingFromHistory = false
        
        EditorTextBox:GetPropertyChangedSignal("Text"):Connect(function()
            if selectedEditorTab and not isUpdatingFromHistory then
                selectedEditorTab.text = EditorTextBox.Text
                
                if editorCurrentIndex < #editorUndoHistory then
                    for i = editorCurrentIndex + 1, #editorUndoHistory do
                        editorUndoHistory[i] = nil
                    end
                end
                
                table.insert(editorUndoHistory, EditorTextBox.Text)
                editorCurrentIndex = #editorUndoHistory
            end
        end)
        
        EditorUndoBtn.MouseButton1Click:Connect(function()
            if editorCurrentIndex > 1 then
                editorCurrentIndex = editorCurrentIndex - 1
                isUpdatingFromHistory = true
                EditorTextBox.Text = editorUndoHistory[editorCurrentIndex]
                if selectedEditorTab then
                    selectedEditorTab.text = EditorTextBox.Text
                end
                isUpdatingFromHistory = false
                TextLabel.Text = "Undo successful!"
            else
                TextLabel.Text = "Nothing to undo!"
            end
        end)
        
        EditorRedoBtn.MouseButton1Click:Connect(function()
            if editorCurrentIndex < #editorUndoHistory then
                editorCurrentIndex = editorCurrentIndex + 1
                isUpdatingFromHistory = true
                EditorTextBox.Text = editorUndoHistory[editorCurrentIndex]
                if selectedEditorTab then
                    selectedEditorTab.text = EditorTextBox.Text
                end
                isUpdatingFromHistory = false
                TextLabel.Text = "Redo successful!"
            else
                TextLabel.Text = "Nothing to redo!"
            end
        end)
        
        EditorClearBtn.MouseButton1Click:Connect(function()
            if EditorTextBox.Text ~= "" then
                EditorTextBox.Text = ""
                if selectedEditorTab then
                    selectedEditorTab.text = ""
                end
                TextLabel.Text = "Editor cleared!"
            else
                TextLabel.Text = "Editor already empty!"
            end
        end)
        
        EditorRunBtn.MouseButton1Click:Connect(function()
            if EditorTextBox.Text ~= "" then
                TextLabel.Text = "Executing editor code..."
                xpcall(function()
                    loadstring(EditorTextBox.Text)()
                    TextLabel.Text = "Editor code executed successfully!"
                end, function(err)
                    TextLabel.Text = "Execution error: " .. tostring(err)
                end)
            else
                TextLabel.Text = "Editor is empty!"
            end
        end)
        
        EditorRenameBtn.MouseButton1Click:Connect(renameEditorTab)
        
        NotesTextBox:GetPropertyChangedSignal("Text"):Connect(function()
            if selectedNotesTab then
                selectedNotesTab.text = NotesTextBox.Text
            end
        end)
        
        NewNoteBtn.MouseButton1Click:Connect(function()
            local noteName = "Note_" .. tostring(#notesTabs + 1)
            createNote(noteName, "")
            TextLabel.Text = "New note created!"
        end)
        
        NotesSaveBtn.MouseButton1Click:Connect(saveNote)
        NotesDeleteBtn.MouseButton1Click:Connect(deleteNote)
        NotesRenameBtn.MouseButton1Click:Connect(renameNotesTab)
        LoadNoteBtn.MouseButton1Click:Connect(showFileBrowser)
        
        BrowserClose.MouseButton1Click:Connect(function()
            FileBrowser.Visible = false
        end)
        
        Background.MouseEnter:Connect(function(...)
            mouseInGui = true
            mouseEntered()
        end)
        Background.MouseLeave:Connect(function(...)
            mouseInGui = false
            mouseEntered()
        end)
        TextLabel:GetPropertyChangedSignal("Text"):Connect(scaleToolTip)
        MinimizeButton.MouseButton1Click:Connect(toggleMinimize)
        MaximizeButton.MouseButton1Click:Connect(toggleSideTray)
        Simple.MouseButton1Click:Connect(onToggleButtonClick)
        CloseButton.MouseEnter:Connect(onXButtonHover)
        CloseButton.MouseLeave:Connect(onXButtonUnhover)
        Simple.MouseEnter:Connect(onToggleButtonHover)
        Simple.MouseLeave:Connect(onToggleButtonUnhover)
        CloseButton.MouseButton1Click:Connect(shutdown)
        table.insert(connections, UserInputService.InputBegan:Connect(backgroundUserInput))
        connectResize()
        SimpleSpy3.Enabled = true
        logthread(spawn(function()
            delay(1,onToggleButtonUnhover)
        end))
        schedulerconnect = RunService.Heartbeat:Connect(taskscheduler)
        bringBackOnResize()
        SimpleSpy3.Parent = (gethui and gethui()) or (syn and syn.protect_gui and syn.protect_gui(SimpleSpy3)) or CoreGui
        logthread(spawn(function()
            local lp = Players.LocalPlayer or Players:GetPropertyChangedSignal("LocalPlayer"):Wait() or Players.LocalPlayer
            generation = {
                [OldDebugId(lp)] = 'game:GetService("Players").LocalPlayer',
                [OldDebugId(lp:GetMouse())] = 'game:GetService("Players").LocalPlayer:GetMouse',
                [OldDebugId(game)] = "game",
                [OldDebugId(workspace)] = "workspace"
            }
        end))
        
        if configs.tabsOpen then
            tabsOpen = false
            toggleTabSidebar()
        end
    end)
    if succeeded then
        getgenv().SimpleSpyExecuted = true
        print("╔═══════════════════════════════════════╗")
        print("║   RSpy V4 Loaded Successfully ✓       ║")
        print("╚═══════════════════════════════════════╝")
    else
        shutdown()
        ErrorPrompt("An error has occured:\n"..rawtostring(err))
        return
    end
else
    SimpleSpy3:Destroy()
    return
end

function SimpleSpy:newButton(name, description, onClick)
    return newButton(name, description, onClick)
end

newButton(
    "Copy Code",
    function() return "Click to copy code" end,
    function()
        setclipboard(codebox:getString())
        TextLabel.Text = "Copied successfully!"
    end
)

newButton(
    "Copy Remote",
    function() return "Click to copy the path of the remote" end,
    function()
        if selected and selected.Remote then
            setclipboard(v2s(selected.Remote))
            TextLabel.Text = "Copied!"
        end
    end
)

newButton("Run Code",
    function() return "Click to execute code" end,
    function()
        local Remote = selected and selected.Remote
        if Remote then
            TextLabel.Text = "Executing..."
            xpcall(function()
                local returnvalue
                if Remote:IsA("RemoteEvent") or Remote:IsA("UnreliableRemoteEvent") then
                    returnvalue = Remote:FireServer(unpack(selected.args))
                elseif Remote:IsA("RemoteFunction") then
                    returnvalue = Remote:InvokeServer(unpack(selected.args))
                end

                TextLabel.Text = ("Executed successfully!\n%s"):format(v2s(returnvalue))
            end,function(err)
                TextLabel.Text = ("Execution error!\n%s"):format(err)
            end)
            return
        end
        TextLabel.Text = "Source not found"
    end
)

newButton(
    "Get Script",
    function() return "Click to copy calling script to clipboard" end,
    function()
        if selected then
            if not selected.Source then
                selected.Source = rawget(getfenv(selected.Function),"script")
            end
            setclipboard(v2s(selected.Source))
            TextLabel.Text = "Done!"
        end
    end
)

newButton("Function Info",function() return "Click to view calling function information" end,
function()
    local func = selected and selected.Function
    if func then
        local typeoffunc = typeof(func)

        if typeoffunc ~= 'string' then
            codebox:setRaw("")
            RunService.Heartbeat:Wait()
            local lclosure = islclosure(func)
            local SourceScript = rawget(getfenv(func),"script")
            local CallingScript = selected.Source or nil
            local info = {}
            
            info = {
                info = getinfo(func),
                constants = lclosure and deepclone(getconstants(func)) or "N/A",
                upvalues = deepclone(getupvalues(func)),
                script = {
                    SourceScript = SourceScript or 'nil',
                    CallingScript = CallingScript or 'nil'
                }
            }
                    
            if configs.advancedinfo then
                local Remote = selected.Remote

                info["advancedinfo"] = {
                    Metamethod = selected.metamethod,
                    DebugId = {
                        SourceScriptDebugId = SourceScript and typeof(SourceScript) == "Instance" and OldDebugId(SourceScript) or "N/A",
                        CallingScriptDebugId = CallingScript and typeof(CallingScript) == "Instance" and OldDebugId(CallingScript) or "N/A",
                        RemoteDebugId = OldDebugId(Remote)
                    },
                    Protos = lclosure and getprotos and getprotos(func) or "N/A"
                }

                if Remote:IsA("RemoteFunction") then
                    info["advancedinfo"]["OnClientInvoke"] = getcallbackmember and (getcallbackmember(Remote,"OnClientInvoke") or "N/A") or "N/A"
                elseif getconnections then
                    info["advancedinfo"]["OnClientEvents"] = {}

                    for i,v in next, getconnections(Remote.OnClientEvent) do
                        info["advancedinfo"]["OnClientEvents"][i] = {
                            Function = v.Function or "N/A",
                            State = v.State or "N/A"
                        }
                    end
                end
            end
            codebox:setRaw("")
            selected.Function = v2v({functionInfo = info})
        end
        codebox:setRaw("\n\n"..selected.Function)
        TextLabel.Text = "Done! Function info generated."
    else
        TextLabel.Text = "Error! Selected function was not found."
    end
end)

newButton(
    "Clr Logs",
    function() return "Click to clear logs" end,
    function()
        TextLabel.Text = "Clearing..."
        clear(logs)
        for i,v in next, LogList:GetChildren() do
            if not v:IsA("UIListLayout") then
                v:Destroy()
            end
        end
        codebox:setRaw("")
        selected = nil
        TextLabel.Text = "Logs cleared!"
    end
)

newButton(
    "Exclude (i)",
    function() return "Click to exclude this Remote" end,
    function()
        if selected then
            blacklist[OldDebugId(selected.Remote)] = true
            TextLabel.Text = "Excluded!"
        end
    end
)

newButton(
    "Exclude (n)",
    function() return "Click to exclude all remotes with this name" end,
    function()
        if selected then
            blacklist[selected.Name] = true
            TextLabel.Text = "Excluded!"
        end
    end
)

newButton("Clr Blacklist",
function() return "Click to clear the blacklist" end,
function()
    blacklist = {}
    TextLabel.Text = "Blacklist cleared!"
end)

newButton(
    "Block (i)",
    function() return "Click to stop this remote from firing" end,
    function()
        if selected then
            blocklist[OldDebugId(selected.Remote)] = true
            TextLabel.Text = "Blocked!"
        end
    end
)

newButton("Block (n)",function()
    return "Click to stop remotes with this name from firing" end,
    function()
        if selected then
            blocklist[selected.Name] = true
            TextLabel.Text = "Blocked!"
        end
    end
)

newButton(
    "Clr Blocklist",
    function() return "Click to stop blocking remotes" end,
    function()
        blocklist = {}
        TextLabel.Text = "Blocklist cleared!"
    end
)

newButton("Decompile",
    function()
        return "Decompile source script"
    end,function()
        if decompile then
            if selected and selected.Source then
                local Source = selected.Source
                if not DecompiledScripts[Source] then
                    codebox:setRaw("")

                    xpcall(function()
                        local decompiledsource = decompile(Source):gsub("","")
                        local Sourcev2s = v2s(Source)
                        if (decompiledsource):find("script") and Sourcev2s then
                            DecompiledScripts[Source] = ("local script = %s\n%s"):format(Sourcev2s,decompiledsource)
                        end
                    end,function(err)
                        return codebox:setRaw(("\n%s\n"):format(err))
                    end)
                end
                codebox:setRaw(DecompiledScripts[Source] or "")
                TextLabel.Text = "Done!"
            else
                TextLabel.Text = "Source not found!"
            end
        else
            TextLabel.Text = "Missing function (decompile)"
        end
    end
)

newButton(
    "Load Editor",
    function() return "Load selected remote in editor" end,
    function()
        pcall(function()
            if selected and selected.Remote then
                local remoteName = selected.Remote.Name
                local code = selected.GenScript
                createEditorTab(remoteName, code)
                switchTab("editor")
                TextLabel.Text = "Loaded in editor!"
            else
                TextLabel.Text = "No remote selected!"
            end
        end)
    end
)

newButton(
    "Disable Info",
    function() return string.format("[%s] Toggle function info", configs.funcEnabled and "ENABLED" or "DISABLED") end,
    function()
        configs.funcEnabled = not configs.funcEnabled
        TextLabel.Text = string.format("[%s] Toggle function info", configs.funcEnabled and "ENABLED" or "DISABLED")
    end
)

newButton(
    "Autoblock",
    function() return string.format("[%s] Intelligently detects spammy remotes", configs.autoblock and "ENABLED" or "DISABLED") end,
    function()
        configs.autoblock = not configs.autoblock
        TextLabel.Text = string.format("[%s] Intelligently detects spammy remotes", configs.autoblock and "ENABLED" or "DISABLED")
        history = {}
        excluding = {}
    end
)

newButton("Logcheckcaller",function()
    return ("[%s] Log remotes fired by the client"):format(configs.logcheckcaller and "ENABLED" or "DISABLED")
end,
function()
    configs.logcheckcaller = not configs.logcheckcaller
    TextLabel.Text = ("[%s] Log remotes fired by the client"):format(configs.logcheckcaller and "ENABLED" or "DISABLED")
end)

newButton("Advanced Info",function()
    return ("[%s] Display more remoteinfo"):format(configs.advancedinfo and "ENABLED" or "DISABLED")
end,
function()
    configs.advancedinfo = not configs.advancedinfo
    TextLabel.Text = ("[%s] Display more remoteinfo"):format(configs.advancedinfo and "ENABLED" or "DISABLED")
end)

if configs.supersecretdevtoggle then
    newButton("Load SSV2.2",function()
        return "Load's Simple Spy V2.2"
    end,
    function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/exxtremestuffs/SimpleSpySource/master/SimpleSpy.lua"))()
    end)
    newButton("Load SSV3",function()
        return "Load's Simple Spy V3"
    end,
    function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/78n/SimpleSpy/main/SimpleSpySource.lua"))()
    end)
end

if table.find({
    Enum.Platform.IOS, Enum.Platform.Android
}, UserInputService:GetPlatform()) then
    Background.Draggable = true
    local QuickCapture = Instance.new("TextButton")
    local UICorner = Instance.new("UICorner")
    QuickCapture.Parent = SimpleSpy3
    QuickCapture.BackgroundColor3 = Color3.fromRGB(37, 36, 38)
    QuickCapture.BackgroundTransparency = 0.14
    QuickCapture.Position = UDim2.new(0.529, 0, 0, 0)
    QuickCapture.Size = UDim2.new(0, 32, 0, 33)
    QuickCapture.Font = Enum.Font.SourceSansBold
    QuickCapture.Text = "Spy"
    QuickCapture.TextColor3 = Background.Visible and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(252, 51, 51)
    QuickCapture.TextSize = 16
    QuickCapture.TextWrapped = true
    QuickCapture.ZIndex = 10
    QuickCapture.Draggable = true
    UICorner.CornerRadius = UDim.new(0.5, 0)
    UICorner.Parent = QuickCapture
    QuickCapture.MouseButton1Click:Connect(function()
        Background.Visible = not Background.Visible
        QuickCapture.TextColor3 = Background.Visible and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(252, 51, 51)
    end)
end
